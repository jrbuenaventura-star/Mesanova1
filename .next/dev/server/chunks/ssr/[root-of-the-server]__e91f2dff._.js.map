{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/jrbuenaventura/Windsurf/Mesanova/lib/db/queries.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\"\nimport type {\n  ProductWithCategories,\n  Warehouse,\n  UserRole,\n  DistributorWithProfile,\n  OrderWithItems,\n  DistributorMonthlySales,\n} from \"./types\"\n\n// Obtener todos los silos con sus subcategorías\nexport async function getSilosWithSubcategories() {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"silos\")\n    .select(`\n      *,\n      subcategories (*)\n    `)\n    .order(\"order_index\")\n\n  if (error) throw error\n  return data\n}\n\n// Obtener un producto por slug con todas sus relaciones\nexport async function getProductBySlug(slug: string): Promise<ProductWithCategories | null> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"products\")\n    .select(`\n      *,\n      collection:collections(*),\n      product_categories (\n        *,\n        subcategory:subcategories (\n          *,\n          silo:silos (*)\n        )\n      ),\n      product_types:product_product_types (\n        *,\n        product_type:product_types (*)\n      ),\n      product_media (*),\n      product_similar (\n        similar_product:products (*)\n      ),\n      product_complement (\n        complement_product:products (*)\n      ),\n      warehouse_stock:product_warehouse_stock (\n        *,\n        warehouse:warehouses (*)\n      )\n    `)\n    .eq(\"slug\", slug)\n    .eq(\"is_active\", true)\n    .single()\n\n  if (error) {\n    console.log(\"[v0] Error fetching product:\", error)\n    return null\n  }\n  return data\n}\n\n// Obtener productos por categoría\nexport async function getProductsBySubcategory(subcategorySlug: string, limit = 20) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"products\")\n    .select(`\n      *,\n      product_categories!inner (\n        subcategory:subcategories!inner (\n          slug\n        )\n      )\n    `)\n    .eq(\"product_categories.subcategory.slug\", subcategorySlug)\n    .eq(\"is_active\", true)\n    .order(\"pdt_descripcion\")\n    .limit(limit)\n\n  if (error) {\n    return []\n  }\n\n  return data || []\n}\n\n// Obtener tipos de producto disponibles por subcategoría (solo los que tienen productos)\nexport async function getAvailableProductTypesBySubcategory(subcategorySlug: string) {\n  const supabase = await createClient()\n\n  const { error: checkError } = await supabase.from(\"product_types\").select(\"id\").limit(1)\n\n  if (checkError) {\n    console.log(\"[v0] product_types table doesn't exist yet, returning empty array\")\n    return []\n  }\n\n  try {\n    const { data, error } = await supabase\n      .from(\"product_types\")\n      .select(\n        `\n        *,\n        subcategory:subcategories!inner (\n          slug\n        ),\n        product_product_types!inner (\n          product:products!inner (\n            is_active\n          )\n        )\n      `,\n      )\n      .eq(\"subcategory.slug\", subcategorySlug)\n      .eq(\"product_product_types.product.is_active\", true)\n      .order(\"order_index\")\n\n    if (error) {\n      console.log(\"[v0] Error fetching product types:\", error)\n      return []\n    }\n\n    return data || []\n  } catch (err) {\n    console.log(\"[v0] Exception fetching product types:\", err)\n    return []\n  }\n}\n\n// Obtener productos filtrados por subcategoría y tipo de producto\nexport async function getProductsBySubcategoryAndType(subcategorySlug: string, productTypeSlug: string) {\n  const supabase = await createClient()\n\n  const { error: checkError } = await supabase.from(\"product_types\").select(\"id\").limit(1)\n\n  if (checkError) {\n    console.log(\"[v0] product_types table doesn't exist yet, falling back to subcategory only\")\n    return getProductsBySubcategory(subcategorySlug)\n  }\n\n  try {\n    const { data, error } = await supabase\n      .from(\"products\")\n      .select(\n        `\n        *,\n        product_categories!inner (\n          subcategory:subcategories!inner (\n            slug\n          )\n        ),\n        product_product_types!inner (\n          product_type:product_types!inner (\n            slug\n          )\n        )\n      `,\n      )\n      .eq(\"product_categories.subcategory.slug\", subcategorySlug)\n      .eq(\"product_product_types.product_type.slug\", productTypeSlug)\n      .eq(\"is_active\", true)\n      .order(\"pdt_descripcion\")\n\n    if (error) {\n      // Si falla el filtrado por tipo, intentar solo por subcategoría\n      const { data: fallbackData, error: fallbackError } = await supabase\n        .from(\"products\")\n        .select(\n          `\n          *,\n          product_categories!inner (\n            subcategory:subcategories!inner (\n              slug\n            )\n          )\n        `,\n        )\n        .eq(\"product_categories.subcategory.slug\", subcategorySlug)\n        .eq(\"is_active\", true)\n        .order(\"pdt_descripcion\")\n\n      if (fallbackError) {\n        return []\n      }\n\n      return fallbackData || []\n    }\n\n    return data || []\n  } catch (err) {\n    console.log(\"[v0] Exception in getProductsBySubcategoryAndType:\", err)\n    return getProductsBySubcategory(subcategorySlug)\n  }\n}\n\n// Obtener productos destacados\nexport async function getFeaturedProducts(limit = 10) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"products\")\n    .select(\"*\")\n    .eq(\"is_active\", true)\n    .eq(\"is_featured\", true)\n    .limit(limit)\n\n  if (error) throw error\n  return data\n}\n\n// Buscar productos\nexport async function searchProducts(query: string, limit = 20) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"products\")\n    .select(\"*\")\n    .eq(\"is_active\", true)\n    .or(`pdt_descripcion.ilike.%${query}%,nombre_comercial.ilike.%${query}%,pdt_codigo.ilike.%${query}%`)\n    .limit(limit)\n\n  if (error) throw error\n  return data\n}\n\n// Obtener disponibilidad de un producto (sincronizado con ERP)\nexport async function getProductAvailability(productCode: string) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"products\")\n    .select(\"pdt_codigo, upp_existencia, pdt_empaque\")\n    .eq(\"pdt_codigo\", productCode)\n    .single()\n\n  if (error) throw error\n  return data\n}\n\n// Obtener todos los almacenes activos\nexport async function getActiveWarehouses() {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.from(\"warehouses\").select(\"*\").eq(\"is_active\", true).order(\"order_index\")\n\n  if (error) throw error\n  return data\n}\n\n// Obtener stock de un producto en todos los almacenes\nexport async function getProductStockByWarehouses(productId: string) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"product_warehouse_stock\")\n    .select(`\n      *,\n      warehouse:warehouses (*)\n    `)\n    .eq(\"product_id\", productId)\n    .order(\"warehouse.order_index\")\n\n  if (error) throw error\n  return data\n}\n\n// Obtener stock disponible en almacenes que pueden despachar\nexport async function getAvailableStockForShipping(productId: string) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"product_warehouse_stock\")\n    .select(`\n      *,\n      warehouse:warehouses!inner (*)\n    `)\n    .eq(\"product_id\", productId)\n    .eq(\"warehouse.can_ship\", true)\n    .eq(\"warehouse.is_active\", true)\n    .gt(\"available_quantity\", 0)\n\n  if (error) throw error\n  return data\n}\n\n// Actualizar stock de un producto en un almacén específico\nexport async function updateWarehouseStock(\n  productId: string,\n  warehouseId: string,\n  quantity: number,\n  reservedQuantity = 0,\n) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"product_warehouse_stock\")\n    .upsert({\n      product_id: productId,\n      warehouse_id: warehouseId,\n      quantity,\n      reserved_quantity: reservedQuantity,\n      last_sync_at: new Date().toISOString(),\n    })\n    .select()\n    .single()\n\n  if (error) throw error\n  return data\n}\n\n// Obtener productos con stock bajo por almacén\nexport async function getLowStockProducts(warehouseId?: string) {\n  const supabase = await createClient()\n\n  let query = supabase\n    .from(\"product_warehouse_stock\")\n    .select(`\n      *,\n      product:products (*),\n      warehouse:warehouses (*)\n    `)\n    .filter(\"available_quantity\", \"lte\", \"min_stock\")\n    .gt(\"min_stock\", 0)\n\n  if (warehouseId) {\n    query = query.eq(\"warehouse_id\", warehouseId)\n  }\n\n  const { data, error } = await query\n\n  if (error) throw error\n  return data\n}\n\n// Crear o actualizar almacén\nexport async function upsertWarehouse(warehouse: Partial<Warehouse>) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.from(\"warehouses\").upsert(warehouse).select().single()\n\n  if (error) throw error\n  return data\n}\n\n// Obtener resumen de todos los almacenes con estadísticas\nexport async function getWarehouseSummary() {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"warehouses\")\n    .select(`\n      *,\n      stock:product_warehouse_stock (\n        quantity,\n        available_quantity,\n        min_stock\n      )\n    `)\n    .eq(\"is_active\", true)\n    .order(\"order_index\")\n\n  if (error) throw error\n  return data\n}\n\n// Obtener perfil de usuario actual\nexport async function getCurrentUserProfile() {\n  const supabase = await createClient()\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n  if (!user) return null\n\n  const { data, error } = await supabase.from(\"user_profiles\").select(\"*\").eq(\"id\", user.id).single()\n\n  if (error) throw error\n  return data\n}\n\n// Obtener perfil con información de distribuidor si aplica\nexport async function getCurrentUserWithDistributor() {\n  const supabase = await createClient()\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n  if (!user) return null\n\n  const { data, error } = await supabase\n    .from(\"user_profiles\")\n    .select(`\n      *,\n      distributor:distributors (*)\n    `)\n    .eq(\"id\", user.id)\n    .single()\n\n  if (error) throw error\n  return data\n}\n\n// Crear o actualizar perfil de usuario\nexport async function upsertUserProfile(\n  userId: string,\n  profile: {\n    role?: UserRole\n    full_name?: string\n    phone?: string\n    document_type?: string\n    document_number?: string\n    shipping_address?: string\n    shipping_city?: string\n    shipping_state?: string\n    shipping_postal_code?: string\n    shipping_country?: string\n  },\n) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"user_profiles\")\n    .upsert({\n      id: userId,\n      ...profile,\n    })\n    .select()\n    .single()\n\n  if (error) throw error\n  return data\n}\n\n// Obtener todos los distribuidores (solo superadmin)\nexport async function getAllDistributors() {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"distributors\")\n    .select(`\n      *,\n      profile:user_profiles (*)\n    `)\n    .order(\"created_at\", { ascending: false })\n\n  if (error) throw error\n  return data as DistributorWithProfile[]\n}\n\n// Obtener información de distribuidor del usuario actual\nexport async function getCurrentDistributor() {\n  const supabase = await createClient()\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n  if (!user) return null\n\n  const { data, error } = await supabase\n    .from(\"distributors\")\n    .select(`\n      *,\n      profile:user_profiles (*)\n    `)\n    .eq(\"user_id\", user.id)\n    .single()\n\n  if (error) {\n    if (error.code === \"PGRST116\") return null // No distributor found\n    throw error\n  }\n  return data as DistributorWithProfile\n}\n\n// Crear o actualizar distribuidor\nexport async function upsertDistributor(distributor: {\n  user_id: string\n  company_name: string\n  company_rif?: string\n  business_type?: string\n  discount_percentage?: number\n  monthly_budget_cocina?: number\n  monthly_budget_mesa?: number\n  monthly_budget_cafe_te_bar?: number\n  monthly_budget_termos_neveras?: number\n  monthly_budget_profesional?: number\n  credit_limit?: number\n}) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.from(\"distributors\").upsert(distributor).select().single()\n\n  if (error) throw error\n  return data\n}\n\n// Obtener precio para distribuidor (considerando precios personalizados)\nexport async function getPriceForDistributor(productId: string, distributorId: string) {\n  const supabase = await createClient()\n\n  // Primero buscar precio personalizado activo\n  const { data: customPrice } = await supabase\n    .from(\"distributor_custom_prices\")\n    .select(\"custom_price, discount_percentage\")\n    .eq(\"distributor_id\", distributorId)\n    .eq(\"product_id\", productId)\n    .eq(\"is_active\", true)\n    .lte(\"valid_from\", new Date().toISOString())\n    .or(`valid_until.is.null,valid_until.gte.${new Date().toISOString()}`)\n    .single()\n\n  if (customPrice) {\n    return customPrice\n  }\n\n  // Si no hay precio personalizado, usar descuento general del distribuidor\n  const { data: distributor } = await supabase\n    .from(\"distributors\")\n    .select(\"discount_percentage\")\n    .eq(\"id\", distributorId)\n    .single()\n\n  return {\n    custom_price: null,\n    discount_percentage: distributor?.discount_percentage || 0,\n  }\n}\n\n// Obtener productos con mayor rotación (top selling)\nexport async function getTopSellingProducts(limit = 20) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"top_selling_products\")\n    .select(`\n      *,\n      product:products (*)\n    `)\n    .eq(\"is_featured\", true)\n    .order(\"order_index\")\n    .limit(limit)\n\n  if (error) throw error\n  return data\n}\n\n// Crear nueva orden\nexport async function createOrder(\n  order: {\n    user_id: string\n    distributor_id?: string\n    subtotal: number\n    discount_amount?: number\n    tax_amount?: number\n    shipping_cost?: number\n    total: number\n    shipping_full_name?: string\n    shipping_phone?: string\n    shipping_address?: string\n    shipping_city?: string\n    shipping_state?: string\n    shipping_postal_code?: string\n    shipping_country?: string\n    notes?: string\n  },\n  items: {\n    product_id: string\n    quantity: number\n    unit_price: number\n    discount_percentage?: number\n    discount_amount?: number\n    subtotal: number\n    warehouse_id?: string\n  }[],\n) {\n  const supabase = await createClient()\n\n  // Generar número de orden único\n  const orderNumber = `ORD-${Date.now()}-${Math.random().toString(36).substr(2, 9).toUpperCase()}`\n\n  // Crear la orden\n  const { data: newOrder, error: orderError } = await supabase\n    .from(\"orders\")\n    .insert({\n      order_number: orderNumber,\n      ...order,\n    })\n    .select()\n    .single()\n\n  if (orderError) throw orderError\n\n  // Crear los items de la orden\n  const orderItems = items.map((item) => ({\n    order_id: newOrder.id,\n    ...item,\n  }))\n\n  const { error: itemsError } = await supabase.from(\"order_items\").insert(orderItems)\n\n  if (itemsError) throw itemsError\n\n  return newOrder\n}\n\n// Obtener órdenes del usuario actual\nexport async function getCurrentUserOrders(limit = 50) {\n  const supabase = await createClient()\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n  if (!user) return []\n\n  const { data, error } = await supabase\n    .from(\"orders\")\n    .select(`\n      *,\n      items:order_items (\n        *,\n        product:products (*),\n        warehouse:warehouses (*)\n      )\n    `)\n    .eq(\"user_id\", user.id)\n    .order(\"created_at\", { ascending: false })\n    .limit(limit)\n\n  if (error) throw error\n  return data as OrderWithItems[]\n}\n\n// Obtener una orden específica con todos sus detalles\nexport async function getOrderById(orderId: string) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"orders\")\n    .select(`\n      *,\n      items:order_items (\n        *,\n        product:products (*),\n        warehouse:warehouses (*)\n      ),\n      user:user_profiles (*),\n      distributor:distributors (\n        *,\n        profile:user_profiles (*)\n      )\n    `)\n    .eq(\"id\", orderId)\n    .single()\n\n  if (error) throw error\n  return data as OrderWithItems\n}\n\n// Actualizar estado de orden\nexport async function updateOrderStatus(\n  orderId: string,\n  updates: {\n    status?: string\n    payment_status?: string\n    tracking_number?: string\n    tracking_url?: string\n    carrier?: string\n    shipped_at?: string\n    delivered_at?: string\n    internal_notes?: string\n  },\n) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.from(\"orders\").update(updates).eq(\"id\", orderId).select().single()\n\n  if (error) throw error\n  return data\n}\n\n// Obtener ventas mensuales del distribuidor actual\nexport async function getDistributorMonthlySales(year?: number, months = 12) {\n  const supabase = await createClient()\n\n  const distributor = await getCurrentDistributor()\n  if (!distributor) return []\n\n  const currentYear = year || new Date().getFullYear()\n\n  const { data, error } = await supabase\n    .from(\"distributor_monthly_sales\")\n    .select(\"*\")\n    .eq(\"distributor_id\", distributor.id)\n    .gte(\"year\", currentYear - 1) // Últimos 2 años\n    .order(\"year\", { ascending: false })\n    .order(\"month\", { ascending: false })\n    .limit(months)\n\n  if (error) throw error\n  return data as DistributorMonthlySales[]\n}\n\n// Obtener ventas del distribuidor comparadas con presupuesto (mes actual)\nexport async function getDistributorCurrentMonthPerformance() {\n  const supabase = await createClient()\n\n  const distributor = await getCurrentDistributor()\n  if (!distributor) return null\n\n  const now = new Date()\n  const year = now.getFullYear()\n  const month = now.getMonth() + 1\n\n  const { data: sales } = await supabase\n    .from(\"distributor_monthly_sales\")\n    .select(\"*\")\n    .eq(\"distributor_id\", distributor.id)\n    .eq(\"year\", year)\n    .eq(\"month\", month)\n    .single()\n\n  return {\n    sales: sales || {\n      sales_cocina: 0,\n      sales_mesa: 0,\n      sales_cafe_te_bar: 0,\n      sales_termos_neveras: 0,\n      sales_profesional: 0,\n      total_sales: 0,\n      total_orders: 0,\n    },\n    budget: {\n      cocina: distributor.monthly_budget_cocina,\n      mesa: distributor.monthly_budget_mesa,\n      cafe_te_bar: distributor.monthly_budget_cafe_te_bar,\n      termos_neveras: distributor.monthly_budget_termos_neveras,\n      profesional: distributor.monthly_budget_profesional,\n      total:\n        distributor.monthly_budget_cocina +\n        distributor.monthly_budget_mesa +\n        distributor.monthly_budget_cafe_te_bar +\n        distributor.monthly_budget_termos_neveras +\n        distributor.monthly_budget_profesional,\n    },\n    distributor,\n  }\n}\n\n// Calcular ventas mensuales de un distribuidor (función auxiliar para admin)\nexport async function calculateDistributorMonthlySales(distributorId: string, year: number, month: number) {\n  const supabase = await createClient()\n\n  const { error } = await supabase.rpc(\"calculate_distributor_monthly_sales\", {\n    p_distributor_id: distributorId,\n    p_year: year,\n    p_month: month,\n  })\n\n  if (error) throw error\n  return true\n}\n\n// Blog queries\n\n// Get all published blog posts with pagination\nexport async function getBlogPosts(limit = 10, offset = 0) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"blog_posts\")\n    .select(`\n      *,\n      author:user_profiles (*),\n      blog_post_categories (\n        category:blog_categories (*)\n      )\n    `)\n    .eq(\"status\", \"published\")\n    .order(\"published_at\", { ascending: false })\n    .range(offset, offset + limit - 1)\n\n  if (error) throw error\n  return data\n}\n\n// Get a single blog post by slug\nexport async function getBlogPostBySlug(slug: string) {\n  const supabase = await createClient()\n\n  console.log(\"[v0] Searching for blog post with slug:\", slug)\n\n  // Get the post first\n  const { data: post, error } = await supabase\n    .from(\"blog_posts\")\n    .select(\"*\")\n    .eq(\"slug\", slug)\n    .eq(\"status\", \"published\")\n    .single()\n\n  console.log(\"[v0] Blog post query result:\", { found: !!post, error: error?.message })\n\n  if (error) {\n    console.error(\"[v0] Error fetching blog post:\", error)\n    return null\n  }\n\n  if (!post) {\n    console.log(\"[v0] No post found with slug:\", slug)\n    return null\n  }\n\n  // Get author separately to avoid RLS recursion\n  let author = null\n  if (post.author_id) {\n    const { data: authorData } = await supabase\n      .from(\"user_profiles\")\n      .select(\"id, full_name, avatar_url\")\n      .eq(\"id\", post.author_id)\n      .single()\n\n    author = authorData\n  }\n\n  // Get categories separately\n  const { data: postCategories } = await supabase\n    .from(\"blog_post_categories\")\n    .select(`\n      category:blog_categories (\n        id,\n        name,\n        slug\n      )\n    `)\n    .eq(\"post_id\", post.id)\n\n  // Increment views count asynchronously (don't wait for it)\n  supabase\n    .from(\"blog_posts\")\n    .update({ views_count: (post.views_count || 0) + 1 })\n    .eq(\"id\", post.id)\n    .then(() => {})\n\n  return {\n    ...post,\n    author,\n    blog_post_categories: postCategories || [],\n  }\n}\n\n// Get blog posts by category\nexport async function getBlogPostsByCategory(categorySlug: string, limit = 10) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"blog_posts\")\n    .select(`\n      *,\n      author:user_profiles (*),\n      blog_post_categories!inner (\n        category:blog_categories!inner (slug)\n      )\n    `)\n    .eq(\"blog_post_categories.blog_categories.slug\", categorySlug)\n    .eq(\"status\", \"published\")\n    .order(\"published_at\", { ascending: false })\n    .limit(limit)\n\n  if (error) throw error\n  return data\n}\n\n// Get all blog categories with post count\nexport async function getBlogCategories() {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"blog_categories\")\n    .select(`\n      *,\n      blog_post_categories (count)\n    `)\n    .order(\"name\")\n\n  if (error) throw error\n  return data\n}\n\n// Search blog posts\nexport async function searchBlogPosts(query: string, limit = 20) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"blog_posts\")\n    .select(`\n      *,\n      author:user_profiles (*),\n      blog_post_categories (\n        category:blog_categories (*)\n      )\n    `)\n    .eq(\"status\", \"published\")\n    .or(`title.ilike.%${query}%,excerpt.ilike.%${query}%,content.ilike.%${query}%`)\n    .order(\"published_at\", { ascending: false })\n    .limit(limit)\n\n  if (error) throw error\n  return data\n}\n\n// Get recent blog posts\nexport async function getRecentBlogPosts(limit = 5) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"blog_posts\")\n    .select(\"id, slug, title, excerpt, featured_image_url, published_at\")\n    .eq(\"status\", \"published\")\n    .order(\"published_at\", { ascending: false })\n    .limit(limit)\n\n  if (error) throw error\n  return data\n}\n\n// Get related blog posts based on categories\nexport async function getRelatedBlogPosts(postId: string, limit = 3) {\n  const supabase = await createClient()\n\n  // Get categories of current post\n  const { data: currentCategories } = await supabase\n    .from(\"blog_post_categories\")\n    .select(\"category_id\")\n    .eq(\"post_id\", postId)\n\n  if (!currentCategories || currentCategories.length === 0) {\n    // If no categories, return recent posts\n    const { data, error } = await supabase\n      .from(\"blog_posts\")\n      .select(\"id, slug, title, excerpt, featured_image_url, published_at\")\n      .eq(\"status\", \"published\")\n      .neq(\"id\", postId)\n      .order(\"published_at\", { ascending: false })\n      .limit(limit)\n\n    return data || []\n  }\n\n  const categoryIds = currentCategories.map((c) => c.category_id)\n\n  // Get posts with same categories\n  const { data: relatedPostIds } = await supabase\n    .from(\"blog_post_categories\")\n    .select(\"post_id\")\n    .in(\"category_id\", categoryIds)\n    .neq(\"post_id\", postId)\n\n  if (!relatedPostIds || relatedPostIds.length === 0) {\n    return []\n  }\n\n  const postIds = [...new Set(relatedPostIds.map((p) => p.post_id))]\n\n  const { data, error } = await supabase\n    .from(\"blog_posts\")\n    .select(\"id, slug, title, excerpt, featured_image_url, published_at\")\n    .eq(\"status\", \"published\")\n    .in(\"id\", postIds)\n    .order(\"published_at\", { ascending: false })\n    .limit(limit)\n\n  return data || []\n}\n\n// Admin: Create or update blog post\nexport async function upsertBlogPost(post: {\n  id?: string\n  slug: string\n  title: string\n  excerpt?: string\n  content: string\n  featured_image_url?: string\n  status?: \"draft\" | \"published\" | \"archived\"\n  published_at?: string\n  author_id?: string\n}) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.from(\"blog_posts\").upsert(post).select().single()\n\n  if (error) throw error\n  return data\n}\n\n// Admin: Delete blog post\nexport async function deleteBlogPost(postId: string) {\n  const supabase = await createClient()\n\n  const { error } = await supabase.from(\"blog_posts\").delete().eq(\"id\", postId)\n\n  if (error) throw error\n  return true\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 653, "column": 0}, "map": {"version":3,"sources":["file:///Users/jrbuenaventura/Windsurf/Mesanova/components/ui/badge.tsx"],"sourcesContent":["import * as React from 'react'\nimport { Slot } from '@radix-ui/react-slot'\nimport { cva, type VariantProps } from 'class-variance-authority'\n\nimport { cn } from '@/lib/utils'\n\nconst badgeVariants = cva(\n  'inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden',\n  {\n    variants: {\n      variant: {\n        default:\n          'border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90',\n        secondary:\n          'border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90',\n        destructive:\n          'border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60',\n        outline:\n          'text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n    },\n  },\n)\n\nfunction Badge({\n  className,\n  variant,\n  asChild = false,\n  ...props\n}: React.ComponentProps<'span'> &\n  VariantProps<typeof badgeVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : 'span'\n\n  return (\n    <Comp\n      data-slot=\"badge\"\n      className={cn(badgeVariants({ variant }), className)}\n      {...props}\n    />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AAEA;;;;;AAEA,MAAM,gBAAgB,IAAA,uKAAG,EACvB,kZACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,SAAS,MAAM,EACb,SAAS,EACT,OAAO,EACP,UAAU,KAAK,EACf,GAAG,OAEuD;IAC1D,MAAM,OAAO,UAAU,wKAAI,GAAG;IAE9B,qBACE,8OAAC;QACC,aAAU;QACV,WAAW,IAAA,kHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 699, "column": 0}, "map": {"version":3,"sources":["file:///Users/jrbuenaventura/Windsurf/Mesanova/app/blog/page.tsx"],"sourcesContent":["import { getBlogPosts, getBlogCategories } from \"@/lib/db/queries\"\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Badge } from \"@/components/ui/badge\"\nimport Link from \"next/link\"\nimport Image from \"next/image\"\nimport { CalendarDays } from \"lucide-react\"\n\nexport const metadata = {\n  title: \"Nuestra Mesa - Blog de Mesanova\",\n  description: \"Artículos, tendencias y consejos sobre decoración de mesa y hogar\",\n}\n\nexport default async function BlogPage() {\n  const posts = await getBlogPosts(20)\n  const categories = await getBlogCategories()\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Header */}\n      <section className=\"py-12 px-4 bg-gradient-to-b from-primary/5 to-background\">\n        <div className=\"container mx-auto\">\n          <h1 className=\"text-4xl md:text-5xl font-bold mb-4\">Nuestra Mesa</h1>\n          <p className=\"text-lg text-muted-foreground max-w-2xl\">\n            Historias, tendencias y consejos sobre decoración de mesa, productos para el hogar y el arte de recibir\n          </p>\n        </div>\n      </section>\n\n      <div className=\"container mx-auto py-12 px-4\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-8\">\n          {/* Main Content */}\n          <div className=\"lg:col-span-3\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {posts.map((post) => (\n                <Link key={post.id} href={`/blog/${post.slug}`}>\n                  <Card className=\"h-full hover:shadow-lg transition-shadow cursor-pointer group\">\n                    {post.featured_image_url && (\n                      <div className=\"relative aspect-video w-full overflow-hidden rounded-t-lg\">\n                        <Image\n                          src={post.featured_image_url}\n                          alt={post.title}\n                          fill\n                          className=\"object-cover group-hover:scale-105 transition-transform duration-300\"\n                          sizes=\"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw\"\n                        />\n                      </div>\n                    )}\n                    <CardHeader>\n                      <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-2\">\n                        <CalendarDays className=\"h-4 w-4\" />\n                        <time dateTime={post.published_at}>\n                          {new Date(post.published_at!).toLocaleDateString(\"es-ES\", {\n                            year: \"numeric\",\n                            month: \"long\",\n                            day: \"numeric\",\n                          })}\n                        </time>\n                      </div>\n                      <CardTitle className=\"group-hover:text-primary transition-colors line-clamp-2\">\n                        {post.title}\n                      </CardTitle>\n                      <CardDescription className=\"line-clamp-3\">{post.excerpt}</CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <span className=\"text-sm text-primary font-medium\">Leer más →</span>\n                    </CardContent>\n                  </Card>\n                </Link>\n              ))}\n            </div>\n          </div>\n\n          {/* Sidebar */}\n          <aside className=\"lg:col-span-1\">\n            <div className=\"sticky top-4\">\n              <Card>\n                <CardHeader>\n                  <CardTitle>Categorías</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"flex flex-col gap-2\">\n                    {categories.map((category) => (\n                      <Link\n                        key={category.id}\n                        href={`/blog/categoria/${category.slug}`}\n                        className=\"flex items-center justify-between p-2 rounded-md hover:bg-muted transition-colors\"\n                      >\n                        <span className=\"text-sm\">{category.name}</span>\n                        <Badge variant=\"secondary\">{category.blog_post_categories?.[0]?.count || 0}</Badge>\n                      </Link>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </aside>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AAEO,MAAM,WAAW;IACtB,OAAO;IACP,aAAa;AACf;AAEe,eAAe;IAC5B,MAAM,QAAQ,MAAM,IAAA,oIAAY,EAAC;IACjC,MAAM,aAAa,MAAM,IAAA,yIAAiB;IAE1C,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAQ,WAAU;0BACjB,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAG,WAAU;sCAAsC;;;;;;sCACpD,8OAAC;4BAAE,WAAU;sCAA0C;;;;;;;;;;;;;;;;;0BAM3D,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;;sCAEb,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC;gCAAI,WAAU;0CACZ,MAAM,GAAG,CAAC,CAAC,qBACV,8OAAC,0LAAI;wCAAe,MAAM,CAAC,MAAM,EAAE,KAAK,IAAI,EAAE;kDAC5C,cAAA,8OAAC,iIAAI;4CAAC,WAAU;;gDACb,KAAK,kBAAkB,kBACtB,8OAAC;oDAAI,WAAU;8DACb,cAAA,8OAAC,wIAAK;wDACJ,KAAK,KAAK,kBAAkB;wDAC5B,KAAK,KAAK,KAAK;wDACf,IAAI;wDACJ,WAAU;wDACV,OAAM;;;;;;;;;;;8DAIZ,8OAAC,uIAAU;;sEACT,8OAAC;4DAAI,WAAU;;8EACb,8OAAC,sOAAY;oEAAC,WAAU;;;;;;8EACxB,8OAAC;oEAAK,UAAU,KAAK,YAAY;8EAC9B,IAAI,KAAK,KAAK,YAAY,EAAG,kBAAkB,CAAC,SAAS;wEACxD,MAAM;wEACN,OAAO;wEACP,KAAK;oEACP;;;;;;;;;;;;sEAGJ,8OAAC,sIAAS;4DAAC,WAAU;sEAClB,KAAK,KAAK;;;;;;sEAEb,8OAAC,4IAAe;4DAAC,WAAU;sEAAgB,KAAK,OAAO;;;;;;;;;;;;8DAEzD,8OAAC,wIAAW;8DACV,cAAA,8OAAC;wDAAK,WAAU;kEAAmC;;;;;;;;;;;;;;;;;uCA9B9C,KAAK,EAAE;;;;;;;;;;;;;;;sCAuCxB,8OAAC;4BAAM,WAAU;sCACf,cAAA,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC,iIAAI;;sDACH,8OAAC,uIAAU;sDACT,cAAA,8OAAC,sIAAS;0DAAC;;;;;;;;;;;sDAEb,8OAAC,wIAAW;sDACV,cAAA,8OAAC;gDAAI,WAAU;0DACZ,WAAW,GAAG,CAAC,CAAC,yBACf,8OAAC,0LAAI;wDAEH,MAAM,CAAC,gBAAgB,EAAE,SAAS,IAAI,EAAE;wDACxC,WAAU;;0EAEV,8OAAC;gEAAK,WAAU;0EAAW,SAAS,IAAI;;;;;;0EACxC,8OAAC,mIAAK;gEAAC,SAAQ;0EAAa,SAAS,oBAAoB,EAAE,CAAC,EAAE,EAAE,SAAS;;;;;;;uDALpE,SAAS,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiBxC"}}]
}