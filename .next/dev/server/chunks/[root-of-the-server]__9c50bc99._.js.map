{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/jrbuenaventura/Windsurf/Mesanova/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  const supabaseUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL\n  const supabaseAnonKey = process.env.SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n\n  if (!supabaseUrl || !supabaseAnonKey) {\n    throw new Error(\"Missing Supabase environment variables\")\n  }\n\n  const client = createServerClient(supabaseUrl, supabaseAnonKey, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n        } catch {\n          // The \"setAll\" method was called from a Server Component.\n          // This can be ignored if you have proxy refreshing user sessions.\n        }\n      },\n    },\n    auth: {\n      detectSessionInUrl: true,\n      flowType: \"pkce\",\n    },\n    global: {\n      headers: {\n        \"X-Client-Info\": \"mesanova-web-server@1.0.0\",\n      },\n    },\n  })\n\n  return client\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY;IAC5C,MAAM,kBAAkB,QAAQ,GAAG,CAAC,iBAAiB;IAErD;;IAIA,MAAM,SAAS,IAAA,iMAAkB,EAAC,aAAa,iBAAiB;QAC9D,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,kEAAkE;gBACpE;YACF;QACF;QACA,MAAM;YACJ,oBAAoB;YACpB,UAAU;QACZ;QACA,QAAQ;YACN,SAAS;gBACP,iBAAiB;YACnB;QACF;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///Users/jrbuenaventura/Windsurf/Mesanova/app/auth/callback/route.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\"\nimport { NextResponse } from \"next/server\"\nimport type { UserRole } from \"@/lib/db/types\"\n\nexport async function GET(request: Request) {\n  const requestUrl = new URL(request.url)\n  const code = requestUrl.searchParams.get(\"code\")\n  const origin = requestUrl.origin\n  const next = requestUrl.searchParams.get(\"next\") || \"/\"\n\n  console.log(\"[v0] Auth callback - code:\", code ? \"present\" : \"missing\")\n\n  if (code) {\n    const supabase = await createClient()\n\n    const { data, error } = await supabase.auth.exchangeCodeForSession(code)\n\n    if (error) {\n      console.error(\"[v0] Auth callback - exchange error:\", error)\n      return NextResponse.redirect(`${origin}/auth/login?error=auth_failed`)\n    }\n\n    if (data?.session) {\n      console.log(\"[v0] Auth callback - session created for user:\", data.user?.email)\n\n      const roleFromMeta = (data.user?.user_metadata as { role?: unknown } | null | undefined)?.role\n      const isValidRole = (v: unknown): v is UserRole => v === \"superadmin\" || v === \"distributor\" || v === \"end_user\"\n\n      if (data.user?.id && isValidRole(roleFromMeta)) {\n        const { error: roleUpdateError } = await supabase\n          .from(\"user_profiles\")\n          .update({ role: roleFromMeta })\n          .eq(\"id\", data.user.id)\n\n        if (roleUpdateError) {\n          console.error(\"[v0] Auth callback - failed to sync role:\", roleUpdateError)\n        }\n      }\n\n      await new Promise((resolve) => setTimeout(resolve, 200))\n\n      const redirectUrl = `${origin}${next}`\n      console.log(\"[v0] Auth callback - redirecting to:\", redirectUrl)\n      return NextResponse.redirect(redirectUrl)\n    }\n  }\n\n  console.log(\"[v0] Auth callback - no code, redirecting to login\")\n  return NextResponse.redirect(`${origin}/auth/login?error=no_code`)\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,eAAe,IAAI,OAAgB;IACxC,MAAM,aAAa,IAAI,IAAI,QAAQ,GAAG;IACtC,MAAM,OAAO,WAAW,YAAY,CAAC,GAAG,CAAC;IACzC,MAAM,SAAS,WAAW,MAAM;IAChC,MAAM,OAAO,WAAW,YAAY,CAAC,GAAG,CAAC,WAAW;IAEpD,QAAQ,GAAG,CAAC,8BAA8B,OAAO,YAAY;IAE7D,IAAI,MAAM;QACR,MAAM,WAAW,MAAM,IAAA,2IAAY;QAEnC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,sBAAsB,CAAC;QAEnE,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,wCAAwC;YACtD,OAAO,gJAAY,CAAC,QAAQ,CAAC,GAAG,OAAO,6BAA6B,CAAC;QACvE;QAEA,IAAI,MAAM,SAAS;YACjB,QAAQ,GAAG,CAAC,kDAAkD,KAAK,IAAI,EAAE;YAEzE,MAAM,eAAgB,KAAK,IAAI,EAAE,eAAyD;YAC1F,MAAM,cAAc,CAAC,IAA8B,MAAM,gBAAgB,MAAM,iBAAiB,MAAM;YAEtG,IAAI,KAAK,IAAI,EAAE,MAAM,YAAY,eAAe;gBAC9C,MAAM,EAAE,OAAO,eAAe,EAAE,GAAG,MAAM,SACtC,IAAI,CAAC,iBACL,MAAM,CAAC;oBAAE,MAAM;gBAAa,GAC5B,EAAE,CAAC,MAAM,KAAK,IAAI,CAAC,EAAE;gBAExB,IAAI,iBAAiB;oBACnB,QAAQ,KAAK,CAAC,6CAA6C;gBAC7D;YACF;YAEA,MAAM,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS;YAEnD,MAAM,cAAc,GAAG,SAAS,MAAM;YACtC,QAAQ,GAAG,CAAC,wCAAwC;YACpD,OAAO,gJAAY,CAAC,QAAQ,CAAC;QAC/B;IACF;IAEA,QAAQ,GAAG,CAAC;IACZ,OAAO,gJAAY,CAAC,QAAQ,CAAC,GAAG,OAAO,yBAAyB,CAAC;AACnE"}}]
}