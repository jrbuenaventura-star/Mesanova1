{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/jrbuenaventura/Windsurf/Mesanova/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  const supabaseUrl = process.env.SUPABASE_URL || process.env.NEXT_PUBLIC_SUPABASE_URL\n  const supabaseAnonKey = process.env.SUPABASE_ANON_KEY || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n\n  if (!supabaseUrl || !supabaseAnonKey) {\n    throw new Error(\"Missing Supabase environment variables\")\n  }\n\n  const client = createServerClient(supabaseUrl, supabaseAnonKey, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n        } catch {\n          // The \"setAll\" method was called from a Server Component.\n          // This can be ignored if you have proxy refreshing user sessions.\n        }\n      },\n    },\n    auth: {\n      detectSessionInUrl: true,\n      flowType: \"pkce\",\n    },\n    global: {\n      headers: {\n        \"X-Client-Info\": \"mesanova-web-server@1.0.0\",\n      },\n    },\n  })\n\n  return client\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY;IAC5C,MAAM,kBAAkB,QAAQ,GAAG,CAAC,iBAAiB;IAErD;;IAIA,MAAM,SAAS,IAAA,iMAAkB,EAAC,aAAa,iBAAiB;QAC9D,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,kEAAkE;gBACpE;YACF;QACF;QACA,MAAM;YACJ,oBAAoB;YACpB,UAAU;QACZ;QACA,QAAQ;YACN,SAAS;gBACP,iBAAiB;YACnB;QACF;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///Users/jrbuenaventura/Windsurf/Mesanova/app/api/products/csv/changelog/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { createClient } from '@/lib/supabase/server';\n\nexport async function GET(request: Request) {\n  try {\n    const supabase = await createClient();\n    const { searchParams } = new URL(request.url);\n    \n    // Verificar autenticación\n    const { data: { user }, error: authError } = await supabase.auth.getUser();\n    \n    if (authError || !user) {\n      return NextResponse.json({ error: 'No autorizado' }, { status: 401 });\n    }\n    \n    // Verificar rol\n    const { data: profile } = await supabase\n      .from('user_profiles')\n      .select('role')\n      .eq('id', user.id)\n      .single();\n    \n    if (!['superadmin', 'canal'].includes(profile?.role || '')) {\n      return NextResponse.json({ error: 'No autorizado' }, { status: 403 });\n    }\n    \n    // Parámetros de filtro\n    const productId = searchParams.get('product_id');\n    const changeType = searchParams.get('change_type');\n    const startDate = searchParams.get('start_date');\n    const endDate = searchParams.get('end_date');\n    const limit = parseInt(searchParams.get('limit') || '50');\n    const offset = parseInt(searchParams.get('offset') || '0');\n    \n    // Construir query\n    let query = supabase\n      .from('product_change_log')\n      .select(`\n        *,\n        product:products(pdt_codigo, nombre_comercial),\n        user:user_profiles(full_name)\n      `)\n      .order('changed_at', { ascending: false })\n      .range(offset, offset + limit - 1);\n    \n    if (productId) {\n      query = query.eq('product_id', productId);\n    }\n    \n    if (changeType) {\n      query = query.eq('change_type', changeType);\n    }\n    \n    if (startDate) {\n      query = query.gte('changed_at', startDate);\n    }\n    \n    if (endDate) {\n      query = query.lte('changed_at', endDate);\n    }\n    \n    const { data: logs, error, count } = await query;\n    \n    if (error) {\n      throw error;\n    }\n    \n    return NextResponse.json({\n      logs,\n      total: count,\n      hasMore: (count || 0) > offset + limit,\n    });\n  } catch (error) {\n    console.error('Error obteniendo changelog:', error);\n    return NextResponse.json(\n      { error: 'Error al obtener historial de cambios' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,2IAAY;QACnC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAE5C,0BAA0B;QAC1B,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;QAExE,IAAI,aAAa,CAAC,MAAM;YACtB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrE;QAEA,gBAAgB;QAChB,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,iBACL,MAAM,CAAC,QACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,MAAM;QAET,IAAI,CAAC;YAAC;YAAc;SAAQ,CAAC,QAAQ,CAAC,SAAS,QAAQ,KAAK;YAC1D,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrE;QAEA,uBAAuB;QACvB,MAAM,YAAY,aAAa,GAAG,CAAC;QACnC,MAAM,aAAa,aAAa,GAAG,CAAC;QACpC,MAAM,YAAY,aAAa,GAAG,CAAC;QACnC,MAAM,UAAU,aAAa,GAAG,CAAC;QACjC,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;QACpD,MAAM,SAAS,SAAS,aAAa,GAAG,CAAC,aAAa;QAEtD,kBAAkB;QAClB,IAAI,QAAQ,SACT,IAAI,CAAC,sBACL,MAAM,CAAC,CAAC;;;;MAIT,CAAC,EACA,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM,GACvC,KAAK,CAAC,QAAQ,SAAS,QAAQ;QAElC,IAAI,WAAW;YACb,QAAQ,MAAM,EAAE,CAAC,cAAc;QACjC;QAEA,IAAI,YAAY;YACd,QAAQ,MAAM,EAAE,CAAC,eAAe;QAClC;QAEA,IAAI,WAAW;YACb,QAAQ,MAAM,GAAG,CAAC,cAAc;QAClC;QAEA,IAAI,SAAS;YACX,QAAQ,MAAM,GAAG,CAAC,cAAc;QAClC;QAEA,MAAM,EAAE,MAAM,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,MAAM;QAE3C,IAAI,OAAO;YACT,MAAM;QACR;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB;YACA,OAAO;YACP,SAAS,CAAC,SAAS,CAAC,IAAI,SAAS;QACnC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwC,GACjD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}