module.exports=[130656,a=>{"use strict";function b(a,[b,c]){return Math.min(c,Math.max(b,a))}a.s(["clamp",()=>b])},917171,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(30553),e=c.forwardRef((a,c)=>(0,b.jsx)(d.Primitive.label,{...a,ref:c,onMouseDown:b=>{b.target.closest("button, input, select, textarea")||(a.onMouseDown?.(b),!b.defaultPrevented&&b.detail>1&&b.preventDefault())}}));e.displayName="Label";var f=a.i(497895);function g({className:a,...c}){return(0,b.jsx)(e,{"data-slot":"label",className:(0,f.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",a),...c})}a.s(["Label",()=>g],917171)},546893,a=>{"use strict";var b=a.i(187924),c=a.i(497895);function d({className:a,...d}){return(0,b.jsx)("textarea",{"data-slot":"textarea",className:(0,c.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),...d})}a.s(["Textarea",()=>d])},781560,a=>{"use strict";let b=(0,a.i(170106).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);a.s(["Trash2",()=>b],781560)},703130,a=>{"use strict";var b=a.i(187924),c=a.i(497895);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card",className:(0,c.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",a),...d})}function e({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-header",className:(0,c.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...d})}function f({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-title",className:(0,c.cn)("leading-none font-semibold",a),...d})}function g({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-description",className:(0,c.cn)("text-muted-foreground text-sm",a),...d})}function h({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-content",className:(0,c.cn)("px-6",a),...d})}function i({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-footer",className:(0,c.cn)("flex items-center px-6 [.border-t]:pt-6",a),...d})}a.s(["Card",()=>d,"CardContent",()=>h,"CardDescription",()=>g,"CardFooter",()=>i,"CardHeader",()=>e,"CardTitle",()=>f])},254161,a=>{"use strict";var b=a.i(187924),c=a.i(811011),d=a.i(400187),e=a.i(497895);let f=(0,d.cva)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function g({className:a,variant:d,asChild:g=!1,...h}){let i=g?c.Slot:"span";return(0,b.jsx)(i,{"data-slot":"badge",className:(0,e.cn)(f({variant:d}),a),...h})}a.s(["Badge",()=>g])},292e3,a=>{"use strict";let b=(0,a.i(170106).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);a.s(["AlertCircle",()=>b],292e3)},265602,a=>{"use strict";var b=a.i(187924),c=a.i(400187),d=a.i(497895);let e=(0,c.cva)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function f({className:a,variant:c,...f}){return(0,b.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,d.cn)(e({variant:c}),a),...f})}function g({className:a,...c}){return(0,b.jsx)("div",{"data-slot":"alert-title",className:(0,d.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",a),...c})}function h({className:a,...c}){return(0,b.jsx)("div",{"data-slot":"alert-description",className:(0,d.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",a),...c})}a.s(["Alert",()=>f,"AlertDescription",()=>h,"AlertTitle",()=>g])},348232,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(269240),f=a.i(340695),g=a.i(205522),h=a.i(917171),i=a.i(887682),j=a.i(546893),k=a.i(703130),l=a.i(265602),m=a.i(781560),n=a.i(538784),o=a.i(292e3),p=a.i(596221),q=a.i(254161);function r({distributors:a,aliadoId:r}){let s=(0,d.useRouter)(),t=(0,e.createClient)(),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(null),M=a.find(a=>a.id===u),N=async a=>{if(a.length<2)return void x([]);H(!0);try{let{data:b,error:c}=await t.from("products").select("id, pdt_codigo, nombre_comercial, precio, upp_existencia").or(`pdt_codigo.ilike.%${a}%,nombre_comercial.ilike.%${a}%`).eq("is_active",!0).limit(10);if(c)throw c;x(b||[])}catch(a){console.error("Error searching products:",a)}finally{H(!1)}},O=a=>{z(y.filter(b=>b.product_id!==a))},P=()=>y.reduce((a,b)=>a+b.subtotal,0),Q=async()=>{if(!u)return void J("Debes seleccionar un distribuidor");if(0===y.length)return void J("Debes agregar al menos un producto");F(!0),J(null),L(null);try{let b=a.find(a=>a.id===u);if(!b)throw Error("Distribuidor no encontrado");let c=P(),d=`ORD-${Date.now()}`,{data:e,error:f}=await t.from("orders").insert({user_id:b.user_id,distributor_id:u,aliado_id:r,status:"por_aprobar",subtotal:c,discount_percentage:b.discount_percentage,shipping_cost:0,total:c,notes:C,customer_name:b.company_name,customer_email:b.contact_email||"",customer_phone:b.contact_phone||"",shipping_address:"Por definir",shipping_city:"Por definir",payment_method:"Por definir",shipping_method:"Por definir",items:y}).select().single();if(f)throw f;try{await fetch("/api/orders/send-notification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e.id})})}catch(a){console.error("Error sending email notification:",a)}L(`Pedido ${d} creado exitosamente. Se ha enviado para aprobaci\xf3n.`),z([]),D(""),v(""),setTimeout(()=>{s.push("/aliado")},2e3)}catch(a){console.error("Error creating order:",a),J(a instanceof Error?a.message:"Error al crear el pedido")}finally{F(!1)}};return(0,b.jsxs)("div",{className:"space-y-6",children:[I&&(0,b.jsxs)(l.Alert,{variant:"destructive",children:[(0,b.jsx)(o.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(l.AlertDescription,{children:I})]}),K&&(0,b.jsx)(l.Alert,{className:"bg-green-50 border-green-200",children:(0,b.jsx)(l.AlertDescription,{className:"text-green-800",children:K})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"distributor",children:"Distribuidor"}),(0,b.jsxs)(i.Select,{value:u,onValueChange:v,children:[(0,b.jsx)(i.SelectTrigger,{id:"distributor",children:(0,b.jsx)(i.SelectValue,{placeholder:"Selecciona un distribuidor"})}),(0,b.jsx)(i.SelectContent,{children:a.map(a=>(0,b.jsxs)(i.SelectItem,{value:a.id,children:[a.company_name," - ",a.discount_percentage,"% descuento"]},a.id))})]})]}),M&&(0,b.jsx)(k.Card,{className:"bg-muted/50",children:(0,b.jsx)(k.CardContent,{className:"pt-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Descuento del distribuidor"}),(0,b.jsxs)("p",{className:"text-2xl font-bold",children:[M.discount_percentage,"%"]})]}),(0,b.jsx)(q.Badge,{variant:"default",children:"Activo"})]})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"search",children:"Buscar Productos"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(g.Input,{id:"search",placeholder:"Buscar por cÃ³digo o nombre...",value:A,onChange:a=>{B(a.target.value),N(a.target.value)},disabled:!u}),G&&(0,b.jsx)(p.Loader2,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 animate-spin"})]}),w.length>0&&(0,b.jsx)(k.Card,{className:"mt-2",children:(0,b.jsx)(k.CardContent,{className:"p-2",children:(0,b.jsx)("div",{className:"space-y-1",children:w.map(a=>(0,b.jsx)("button",{onClick:()=>(a=>{if(y.find(b=>b.product_id===a.id))z(y.map(b=>b.product_id===a.id?{...b,quantity:b.quantity+1,subtotal:(b.quantity+1)*b.unit_price}:b));else{let b=M?.discount_percentage||0,c=(a.precio||0)*(1-b/100);z([...y,{product_id:a.id,product_code:a.pdt_codigo,product_name:a.nombre_comercial||a.pdt_codigo,quantity:1,unit_price:c,discount_percentage:b,subtotal:c}])}B(""),x([])})(a),className:"w-full text-left p-2 hover:bg-muted rounded-lg transition-colors",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-sm",children:a.nombre_comercial}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a.pdt_codigo})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("p",{className:"font-bold text-sm",children:["$",a.precio?.toFixed(2)]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Stock: ",a.upp_existencia]})]})]})},a.id))})})})]}),y.length>0&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Productos en el pedido"}),(0,b.jsxs)(q.Badge,{variant:"secondary",children:[y.length," productos"]})]}),(0,b.jsx)("div",{className:"space-y-2",children:y.map(a=>(0,b.jsx)(k.Card,{children:(0,b.jsx)(k.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium",children:a.product_name}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.product_code}),(0,b.jsxs)("p",{className:"text-xs text-green-600",children:["Descuento: ",a.discount_percentage,"%"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(g.Input,{type:"number",min:"1",value:a.quantity,onChange:b=>{var c,d;return c=a.product_id,void((d=parseInt(b.target.value)||0)<=0?O(c):z(y.map(a=>a.product_id===c?{...a,quantity:d,subtotal:d*a.unit_price}:a)))},className:"w-20"}),(0,b.jsxs)("div",{className:"text-right min-w-[100px]",children:[(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["$",a.unit_price.toFixed(2)," c/u"]}),(0,b.jsxs)("p",{className:"font-bold",children:["$",a.subtotal.toFixed(2)]})]}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:()=>O(a.product_id),children:(0,b.jsx)(m.Trash2,{className:"h-4 w-4 text-destructive"})})]})]})})},a.product_id))}),(0,b.jsx)(k.Card,{className:"bg-primary/5",children:(0,b.jsx)(k.CardContent,{className:"p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between text-lg font-bold",children:[(0,b.jsx)("span",{children:"Total"}),(0,b.jsxs)("span",{children:["$",P().toFixed(2)]})]})})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"notes",children:"Notas del pedido (opcional)"}),(0,b.jsx)(j.Textarea,{id:"notes",placeholder:"Agrega notas o instrucciones especiales...",value:C,onChange:a=>D(a.target.value),rows:3})]}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsx)(f.Button,{onClick:Q,disabled:E||!u||0===y.length,className:"flex-1",children:E?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Creando pedido..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.ShoppingCart,{className:"mr-2 h-4 w-4"}),"Crear Pedido"]})})})]})]})}a.s(["CreateOrderForDistributorForm",()=>r])}];

//# sourceMappingURL=_77209008._.js.map