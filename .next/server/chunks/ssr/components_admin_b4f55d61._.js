module.exports=[29831,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(866965),e=a.i(773320),f=a.i(284505),g=a.i(624722),h=a.i(292e3),i=a.i(816201),j=a.i(862722),k=a.i(669520),l=a.i(104720),m=a.i(797063),n=a.i(340695),o=a.i(703130),p=a.i(265602),q=a.i(254161),r=a.i(602150),s=a.i(588237),t=a.i(887682),u=a.i(586547),v=a.i(621958);function w(){let[a,w]=(0,c.useState)("upload"),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)("update"),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(null),L=async a=>{if((a.headers.get("content-type")||"").includes("application/json"))return a.json();let b=await a.text(),c=401===a.status&&(b.includes("_vercel_sso_nonce")||b.toLowerCase().includes("vercel"));throw Error(`${c?"Vercel está bloqueando la ruta (Deployment Protection/SSO). Desactiva la protección del deployment o permite acceso público a /api/* y redeploy.":"La API devolvió una respuesta no-JSON."} (HTTP ${a.status})`)},M=(0,c.useCallback)(async a=>{let b=a[0];if(b){y(b),K(null),G(!0);try{let a=new FormData;a.append("file",b);let c=await fetch("/api/products/csv/validate",{method:"POST",body:a}),d=await L(c);if(!c.ok)throw Error(d.error||"Error al validar archivo");A(d),w("preview")}catch(a){K(a instanceof Error?a.message:"Error desconocido")}finally{G(!1)}}},[]),{getRootProps:N,getInputProps:O,isDragActive:P}=(0,d.useDropzone)({onDrop:M,accept:{"text/csv":[".csv"],"application/vnd.ms-excel":[".csv"]},maxFiles:1}),Q=async()=>{if(x){I(!0),w("importing"),K(null);try{let a=new FormData;a.append("file",x),a.append("mode",D);let b=await fetch("/api/products/csv/import",{method:"POST",body:a}),c=await L(b);if(!b.ok)throw Error(c.error||"Error al importar archivo");C(c),w("complete")}catch(a){K(a instanceof Error?a.message:"Error desconocido"),w("preview")}finally{I(!1)}}},R=()=>{w("upload"),y(null),A(null),C(null),K(null)},S=async a=>{window.open(a?"/api/products/csv/template?descriptions=true":"/api/products/csv/template","_blank")},T=async()=>{window.open("/api/products/csv/export","_blank")};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold",children:"Gestión de Productos CSV"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Importa, exporta y sincroniza productos masivamente"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(n.Button,{variant:"outline",onClick:()=>S(!1),children:[(0,b.jsx)(f.Download,{className:"w-4 h-4 mr-2"}),"Template vacío"]}),(0,b.jsxs)(n.Button,{variant:"outline",onClick:()=>S(!0),children:[(0,b.jsx)(l.FileText,{className:"w-4 h-4 mr-2"}),"Template con instrucciones"]}),(0,b.jsxs)(n.Button,{variant:"secondary",onClick:T,children:[(0,b.jsx)(g.FileSpreadsheet,{className:"w-4 h-4 mr-2"}),"Exportar productos"]})]})]}),J&&(0,b.jsxs)(p.Alert,{variant:"destructive",children:[(0,b.jsx)(h.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(p.AlertTitle,{children:"Error"}),(0,b.jsx)(p.AlertDescription,{children:J})]}),"upload"===a&&(0,b.jsxs)(o.Card,{children:[(0,b.jsxs)(o.CardHeader,{children:[(0,b.jsx)(o.CardTitle,{children:"Subir archivo CSV"}),(0,b.jsx)(o.CardDescription,{children:"Arrastra un archivo CSV o haz clic para seleccionarlo"})]}),(0,b.jsxs)(o.CardContent,{children:[(0,b.jsxs)("div",{...N(),className:`
                border-2 border-dashed rounded-lg p-12 text-center cursor-pointer
                transition-colors
                ${P?"border-primary bg-primary/5":"border-muted-foreground/25"}
                ${F?"opacity-50 pointer-events-none":""}
              `,children:[(0,b.jsx)("input",{...O()}),F?(0,b.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,b.jsx)(k.RefreshCw,{className:"w-12 h-12 animate-spin text-primary"}),(0,b.jsx)("p",{className:"text-lg",children:"Validando archivo..."})]}):(0,b.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,b.jsx)(e.Upload,{className:"w-12 h-12 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-lg font-medium",children:P?"Suelta el archivo aquí":"Arrastra un archivo CSV aquí"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"o haz clic para seleccionar"})]})]})]}),(0,b.jsx)("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(m.Info,{className:"w-5 h-5 text-blue-500 mt-0.5"}),(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Información importante:"}),(0,b.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-muted-foreground",children:[(0,b.jsx)("li",{children:"El archivo debe estar en formato CSV con codificación UTF-8"}),(0,b.jsx)("li",{children:"Los campos obligatorios son: Ref, Producto, Precio_COP"}),(0,b.jsx)("li",{children:"Las imágenes deben ser URLs válidas"}),(0,b.jsx)("li",{children:"Los productos existentes se identifican por la columna Ref"})]})]})]})})]})]}),"preview"===a&&z&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:z.stats.total}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total filas"})]})}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:z.stats.valid}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Válidas"})]})}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:z.stats.invalid}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Con errores"})]})}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:z.stats.toCreate}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Nuevos"})]})}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-amber-600",children:z.stats.toUpdate}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"A actualizar"})]})}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:z.stats.unchanged}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Sin cambios"})]})})]}),z.globalErrors.length>0&&(0,b.jsxs)(p.Alert,{variant:"destructive",children:[(0,b.jsx)(h.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(p.AlertTitle,{children:"Problemas con el archivo"}),(0,b.jsx)(p.AlertDescription,{children:(0,b.jsx)("ul",{className:"list-disc list-inside mt-2",children:z.globalErrors.map((a,c)=>(0,b.jsx)("li",{children:a},c))})})]}),(0,b.jsxs)(v.Tabs,{defaultValue:"changes",children:[(0,b.jsxs)(v.TabsList,{children:[(0,b.jsxs)(v.TabsTrigger,{value:"changes",children:["Cambios (",z.stats.toCreate+z.stats.toUpdate,")"]}),(0,b.jsxs)(v.TabsTrigger,{value:"errors",children:["Errores (",z.stats.invalid,")"]}),(0,b.jsx)(v.TabsTrigger,{value:"all",children:"Todos los productos"})]}),(0,b.jsx)(v.TabsContent,{value:"changes",className:"mt-4",children:(0,b.jsx)(o.Card,{children:(0,b.jsx)(o.CardContent,{className:"pt-6",children:(0,b.jsx)("div",{className:"max-h-96 overflow-auto",children:(0,b.jsxs)(s.Table,{children:[(0,b.jsx)(s.TableHeader,{children:(0,b.jsxs)(s.TableRow,{children:[(0,b.jsx)(s.TableHead,{children:"Ref"}),(0,b.jsx)(s.TableHead,{children:"Acción"}),(0,b.jsx)(s.TableHead,{children:"Campos modificados"})]})}),(0,b.jsx)(s.TableBody,{children:z.diffs.filter(a=>"unchanged"!==a.changeType).map(a=>(0,b.jsxs)(s.TableRow,{children:[(0,b.jsx)(s.TableCell,{className:"font-mono",children:a.ref}),(0,b.jsx)(s.TableCell,{children:(0,b.jsx)(q.Badge,{variant:"create"===a.changeType?"default":"secondary",children:"create"===a.changeType?"Nuevo":"Actualizar"})}),(0,b.jsx)(s.TableCell,{children:"create"===a.changeType?(0,b.jsx)("span",{className:"text-muted-foreground",children:"Producto nuevo"}):(0,b.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.changes.slice(0,5).map(a=>(0,b.jsx)(q.Badge,{variant:"outline",children:a.field},a.field)),a.changes.length>5&&(0,b.jsxs)(q.Badge,{variant:"outline",children:["+",a.changes.length-5," más"]})]})})]},a.ref))})]})})})})}),(0,b.jsx)(v.TabsContent,{value:"errors",className:"mt-4",children:(0,b.jsx)(o.Card,{children:(0,b.jsx)(o.CardContent,{className:"pt-6",children:0===z.stats.invalid?(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(i.CheckCircle,{className:"w-12 h-12 mx-auto mb-4 text-green-500"}),(0,b.jsx)("p",{children:"No hay errores de validación"})]}):(0,b.jsx)(u.Accordion,{type:"single",collapsible:!0,className:"w-full",children:z.products.filter(a=>!a.isValid).map(a=>(0,b.jsxs)(u.AccordionItem,{value:`row-${a.row}`,children:[(0,b.jsx)(u.AccordionTrigger,{children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(j.XCircle,{className:"w-4 h-4 text-red-500"}),(0,b.jsxs)("span",{children:["Fila ",a.row]}),(0,b.jsx)("span",{className:"font-mono text-sm",children:a.data.Ref||"(sin referencia)"}),(0,b.jsxs)(q.Badge,{variant:"destructive",children:[a.errors.length," error(es)"]})]})}),(0,b.jsx)(u.AccordionContent,{children:(0,b.jsx)("ul",{className:"space-y-2 pl-8",children:a.errors.map((a,c)=>(0,b.jsxs)("li",{className:"text-sm",children:[(0,b.jsxs)("span",{className:"font-medium",children:[a.field,":"]})," ",a.message,a.value&&(0,b.jsxs)("span",{className:"text-muted-foreground",children:[" ",'(valor: "',a.value,'")']})]},c))})})]},a.row))})})})}),(0,b.jsx)(v.TabsContent,{value:"all",className:"mt-4",children:(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"max-h-96 overflow-auto",children:(0,b.jsxs)(s.Table,{children:[(0,b.jsx)(s.TableHeader,{children:(0,b.jsxs)(s.TableRow,{children:[(0,b.jsx)(s.TableHead,{children:"Fila"}),(0,b.jsx)(s.TableHead,{children:"Ref"}),(0,b.jsx)(s.TableHead,{children:"Producto"}),(0,b.jsx)(s.TableHead,{children:"Precio"}),(0,b.jsx)(s.TableHead,{children:"Estado"})]})}),(0,b.jsx)(s.TableBody,{children:z.products.map(a=>(0,b.jsxs)(s.TableRow,{children:[(0,b.jsx)(s.TableCell,{children:a.row}),(0,b.jsx)(s.TableCell,{className:"font-mono",children:a.data.Ref}),(0,b.jsx)(s.TableCell,{className:"max-w-xs truncate",children:a.data.Producto}),(0,b.jsxs)(s.TableCell,{children:["$",Number(a.data.Precio_COP||0).toLocaleString()]}),(0,b.jsx)(s.TableCell,{children:a.isValid?(0,b.jsxs)(q.Badge,{variant:"outline",className:"text-green-600",children:[(0,b.jsx)(i.CheckCircle,{className:"w-3 h-3 mr-1"}),"Válido"]}):(0,b.jsxs)(q.Badge,{variant:"destructive",children:[(0,b.jsx)(j.XCircle,{className:"w-3 h-3 mr-1"}),a.errors.length," error(es)"]})})]},a.row))})]})}),z.hasMore&&(0,b.jsx)("p",{className:"text-center text-sm text-muted-foreground mt-4",children:"Mostrando los primeros 100 productos..."})]})})})]}),(0,b.jsxs)(o.Card,{children:[(0,b.jsx)(o.CardHeader,{children:(0,b.jsx)(o.CardTitle,{children:"Opciones de importación"})}),(0,b.jsx)(o.CardContent,{children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-6 items-start md:items-end",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Modo de importación"}),(0,b.jsxs)(t.Select,{value:D,onValueChange:a=>E(a),children:[(0,b.jsx)(t.SelectTrigger,{className:"w-full md:w-64",children:(0,b.jsx)(t.SelectValue,{})}),(0,b.jsxs)(t.SelectContent,{children:[(0,b.jsx)(t.SelectItem,{value:"update",children:"Actualizar existentes y crear nuevos"}),(0,b.jsx)(t.SelectItem,{value:"add_only",children:"Solo agregar nuevos"}),(0,b.jsx)(t.SelectItem,{value:"replace_all",children:"Reemplazar toda la base (peligroso)"})]})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["update"===D&&"Los productos existentes se actualizarán con los nuevos valores","add_only"===D&&"Solo se crearán productos nuevos, los existentes no se modificarán","replace_all"===D&&"⚠️ Todos los productos serán reemplazados"]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(n.Button,{variant:"outline",onClick:R,children:"Cancelar"}),(0,b.jsx)(n.Button,{onClick:Q,disabled:z.stats.invalid>0,children:z.stats.invalid>0?"Corrige los errores primero":(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.Upload,{className:"w-4 h-4 mr-2"}),"Importar ",z.stats.valid," productos"]})})]})]})})]})]}),"importing"===a&&(0,b.jsx)(o.Card,{children:(0,b.jsx)(o.CardContent,{className:"py-12",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-6",children:[(0,b.jsx)(k.RefreshCw,{className:"w-16 h-16 animate-spin text-primary"}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h3",{className:"text-xl font-bold mb-2",children:"Importando productos..."}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Por favor espera mientras se procesan los productos"})]}),(0,b.jsx)(r.Progress,{value:33,className:"w-64"})]})})}),"complete"===a&&B&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(p.Alert,{variant:B.success?"default":"destructive",children:[B.success?(0,b.jsx)(i.CheckCircle,{className:"h-4 w-4"}):(0,b.jsx)(h.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(p.AlertTitle,{children:B.success?"Importación completada":"Importación completada con errores"}),(0,b.jsxs)(p.AlertDescription,{children:["Se procesaron ",B.created+B.updated+B.skipped," ","productos"]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:B.created}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Creados"})]})}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:B.updated}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Actualizados"})]})}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:B.skipped}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Omitidos"})]})}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:B.errors.length}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Errores"})]})})]}),B.errors.length>0&&(0,b.jsxs)(o.Card,{children:[(0,b.jsx)(o.CardHeader,{children:(0,b.jsx)(o.CardTitle,{className:"text-red-600",children:"Errores durante la importación"})}),(0,b.jsxs)(o.CardContent,{children:[(0,b.jsxs)(s.Table,{children:[(0,b.jsx)(s.TableHeader,{children:(0,b.jsxs)(s.TableRow,{children:[(0,b.jsx)(s.TableHead,{children:"Fila"}),(0,b.jsx)(s.TableHead,{children:"Ref"}),(0,b.jsx)(s.TableHead,{children:"Error"})]})}),(0,b.jsx)(s.TableBody,{children:B.errors.map((a,c)=>(0,b.jsxs)(s.TableRow,{children:[(0,b.jsx)(s.TableCell,{children:a.row}),(0,b.jsx)(s.TableCell,{className:"font-mono",children:a.ref}),(0,b.jsx)(s.TableCell,{children:a.error})]},c))})]}),B.hasMoreErrors&&(0,b.jsx)("p",{className:"text-center text-sm text-muted-foreground mt-4",children:"Mostrando los primeros 20 errores..."})]})]}),(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsxs)(n.Button,{onClick:R,children:[(0,b.jsx)(k.RefreshCw,{className:"w-4 h-4 mr-2"}),"Nueva importación"]})})]})]})}a.s(["CSVProductManager",()=>w])},584725,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(256711),e=a.i(933575),f=a.i(170106);let g=(0,f.default)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);var h=a.i(624722);let i=(0,f.default)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);var j=a.i(546842);let k=(0,f.default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var l=a.i(703130),m=a.i(254161),n=a.i(340695),o=a.i(205522),p=a.i(887682),q=a.i(586547),r=a.i(588237);function s({productId:a}){let[f,s]=(0,c.useState)([]),[t,u]=(0,c.useState)(!0),[v,w]=(0,c.useState)("all"),[x,y]=(0,c.useState)("all"),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(0),H=async(b=!1)=>{u(!0);let c=b?0:F;try{let d=new URLSearchParams;a&&d.set("product_id",a),"all"!==v&&d.set("change_type",v),z&&d.set("start_date",z),B&&d.set("end_date",B),d.set("limit","20"),d.set("offset",c.toString());let e=await fetch(`/api/products/csv/changelog?${d}`),f=await e.json();b?s(f.logs||[]):s(a=>[...a,...f.logs||[]]),E(f.hasMore),G(c+20)}catch(a){console.error("Error fetching changelog:",a)}finally{u(!1)}};return(0,c.useEffect)(()=>{H(!0)},[a,v,x,z,B]),(0,b.jsxs)(l.Card,{children:[(0,b.jsx)(l.CardHeader,{children:(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(g,{className:"w-5 h-5"}),"Historial de Cambios"]})})}),(0,b.jsxs)(l.CardContent,{children:[(0,b.jsxs)("div",{className:"flex flex-wrap gap-4 mb-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k,{className:"w-4 h-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Filtros:"})]}),(0,b.jsxs)(p.Select,{value:v,onValueChange:w,children:[(0,b.jsx)(p.SelectTrigger,{className:"w-40",children:(0,b.jsx)(p.SelectValue,{placeholder:"Tipo de cambio"})}),(0,b.jsxs)(p.SelectContent,{children:[(0,b.jsx)(p.SelectItem,{value:"all",children:"Todos"}),(0,b.jsx)(p.SelectItem,{value:"create",children:"Creación"}),(0,b.jsx)(p.SelectItem,{value:"update",children:"Actualización"}),(0,b.jsx)(p.SelectItem,{value:"csv_import",children:"CSV Import"}),(0,b.jsx)(p.SelectItem,{value:"erp_sync",children:"ERP Sync"})]})]}),(0,b.jsx)(o.Input,{type:"date",value:z,onChange:a=>A(a.target.value),className:"w-40",placeholder:"Desde"}),(0,b.jsx)(o.Input,{type:"date",value:B,onChange:a=>C(a.target.value),className:"w-40",placeholder:"Hasta"})]}),t&&0===f.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando historial..."}):0===f.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No hay cambios registrados"}):(0,b.jsx)(q.Accordion,{type:"single",collapsible:!0,className:"w-full",children:f.map(c=>{var f;return(0,b.jsxs)(q.AccordionItem,{value:c.id,children:[(0,b.jsx)(q.AccordionTrigger,{children:(0,b.jsxs)("div",{className:"flex items-center gap-4 flex-1 text-left",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:(0,d.format)(new Date(c.changed_at),"dd MMM yyyy HH:mm",{locale:e.es})}),(0,b.jsx)(m.Badge,{variant:{create:"default",update:"secondary",csv_import:"outline",erp_sync:"outline"}[c.change_type]||"outline",children:{create:"Creación",update:"Actualización",csv_import:"Importación CSV",erp_sync:"Sincronización ERP"}[f=c.change_type]||f}),!a&&c.product&&(0,b.jsx)("span",{className:"font-mono text-sm",children:c.product.pdt_codigo}),(0,b.jsxs)("span",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[(a=>{switch(a){case"csv":return(0,b.jsx)(h.FileSpreadsheet,{className:"w-4 h-4"});case"erp":return(0,b.jsx)(i,{className:"w-4 h-4"});case"admin":return(0,b.jsx)(j.User,{className:"w-4 h-4"});default:return null}})(c.change_source),c.change_source]})]})}),(0,b.jsx)(q.AccordionContent,{children:(0,b.jsxs)("div",{className:"pl-4 space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm",children:[c.user&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Usuario:"})," ",c.user.full_name]}),c.csv_filename&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Archivo:"})," ",c.csv_filename]}),c.csv_row_number&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Fila:"})," ",c.csv_row_number]})]}),"create"===c.change_type?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Producto creado"}):(0,b.jsxs)(r.Table,{children:[(0,b.jsx)(r.TableHeader,{children:(0,b.jsxs)(r.TableRow,{children:[(0,b.jsx)(r.TableHead,{children:"Campo"}),(0,b.jsx)(r.TableHead,{children:"Valor anterior"}),(0,b.jsx)(r.TableHead,{children:"Nuevo valor"})]})}),(0,b.jsx)(r.TableBody,{children:Object.entries(c.fields_changed).map(([a,c])=>(0,b.jsxs)(r.TableRow,{children:[(0,b.jsx)(r.TableCell,{className:"font-medium",children:a}),(0,b.jsx)(r.TableCell,{className:"text-red-600 max-w-xs truncate",children:c.old||"(vacío)"}),(0,b.jsx)(r.TableCell,{className:"text-green-600 max-w-xs truncate",children:c.new||"(vacío)"})]},a))})]})]})})]},c.id)})}),D&&(0,b.jsx)("div",{className:"text-center mt-4",children:(0,b.jsx)(n.Button,{variant:"outline",onClick:()=>H(!1),disabled:t,children:t?"Cargando...":"Cargar más"})})]})]})}a.s(["ProductChangelog",()=>s],584725)}];

//# sourceMappingURL=components_admin_b4f55d61._.js.map