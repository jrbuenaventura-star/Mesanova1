module.exports=[119192,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(256711),e=a.i(42724),f=a.i(244513),g=a.i(852587),h=a.i(23464),i=a.i(57270),j=a.i(774016);function k(a,b){let c=(0,j.toDate)(a)-(0,j.toDate)(b);return c<0?-1:c>0?1:c}var l=a.i(959296),m=a.i(933575),n=a.i(73570),o=a.i(292e3),p=a.i(641710),q=a.i(816201),r=a.i(669520),s=a.i(170106);let t=(0,s.default)("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),u=(0,s.default)("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var v=a.i(463910);let w=(0,s.default)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);var x=a.i(703130),y=a.i(254161),z=a.i(340695),A=a.i(546893),B=a.i(965733),C=a.i(621958);function D({showGenerateButton:a=!1}){let[s,D]=(0,c.useState)([]),[E,F]=(0,c.useState)({total:0,warning:0,critical:0,dormant:0}),[G,H]=(0,c.useState)(!0),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)("unresolved"),[M,N]=(0,c.useState)(null),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)(""),[S,T]=(0,c.useState)(!1);(0,c.useEffect)(()=>{U()},[K]);let U=async()=>{H(!0);try{let a=new URLSearchParams;"unresolved"===K&&a.set("unresolved","true");let b=await fetch(`/api/alerts/distributors?${a}`),c=await b.json();b.ok&&(D(c.alerts||[]),F(c.stats||{total:0,warning:0,critical:0,dormant:0}))}catch(a){console.error("Error fetching alerts:",a)}finally{H(!1)}},V=async()=>{J(!0);try{let a=await fetch("/api/alerts/distributors",{method:"POST"}),b=await a.json();a.ok&&(alert(`${b.message}`),U())}catch(a){console.error("Error generating alerts:",a)}finally{J(!1)}},W=async a=>{try{await fetch("/api/alerts/distributors",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({alertId:a,action:"mark_read"})}),D(s.map(b=>b.id===a?{...b,is_read:!0}:b))}catch(a){console.error("Error marking as read:",a)}},X=async()=>{if(M){T(!0);try{(await fetch("/api/alerts/distributors",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({alertId:M.id,action:"resolve",notes:Q})})).ok&&(D(s.map(a=>a.id===M.id?{...a,is_resolved:!0,resolved_at:new Date().toISOString(),resolution_notes:Q}:a)),P(!1),N(null),R(""))}catch(a){console.error("Error resolving alert:",a)}finally{T(!1)}}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[(0,b.jsx)(t,{className:"w-6 h-6"}),"Alertas de Distribuidores"]}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Distribuidores que no han comprado recientemente"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[a&&(0,b.jsxs)(z.Button,{variant:"outline",onClick:V,disabled:I,children:[I?(0,b.jsx)(r.RefreshCw,{className:"w-4 h-4 mr-2 animate-spin"}):(0,b.jsx)(t,{className:"w-4 h-4 mr-2"}),"Generar Alertas"]}),(0,b.jsxs)(z.Button,{variant:"outline",onClick:U,disabled:G,children:[(0,b.jsx)(r.RefreshCw,{className:`w-4 h-4 mr-2 ${G?"animate-spin":""}`}),"Actualizar"]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,b.jsx)(x.Card,{children:(0,b.jsx)(x.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:E.total}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total alertas"})]}),(0,b.jsx)(t,{className:"w-8 h-8 text-muted-foreground"})]})})}),(0,b.jsx)(x.Card,{className:"border-amber-200 bg-amber-50",children:(0,b.jsx)(x.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-amber-600",children:E.warning}),(0,b.jsx)("p",{className:"text-sm text-amber-700",children:"Advertencia"})]}),(0,b.jsx)(p.Clock,{className:"w-8 h-8 text-amber-500"})]})})}),(0,b.jsx)(x.Card,{className:"border-orange-200 bg-orange-50",children:(0,b.jsx)(x.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:E.critical}),(0,b.jsx)("p",{className:"text-sm text-orange-700",children:"Crítico"})]}),(0,b.jsx)(n.AlertTriangle,{className:"w-8 h-8 text-orange-500"})]})})}),(0,b.jsx)(x.Card,{className:"border-red-200 bg-red-50",children:(0,b.jsx)(x.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:E.dormant}),(0,b.jsx)("p",{className:"text-sm text-red-700",children:"Dormido"})]}),(0,b.jsx)(o.AlertCircle,{className:"w-8 h-8 text-red-500"})]})})})]}),(0,b.jsx)(C.Tabs,{value:K,onValueChange:a=>L(a),children:(0,b.jsxs)(C.TabsList,{children:[(0,b.jsx)(C.TabsTrigger,{value:"unresolved",children:"Sin resolver"}),(0,b.jsx)(C.TabsTrigger,{value:"all",children:"Todas"})]})}),G?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(r.RefreshCw,{className:"w-8 h-8 animate-spin mx-auto text-muted-foreground"}),(0,b.jsx)("p",{className:"mt-2 text-muted-foreground",children:"Cargando alertas..."})]}):0===s.length?(0,b.jsx)(x.Card,{children:(0,b.jsxs)(x.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)(u,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium",children:"No hay alertas"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"unresolved"===K?"Todas las alertas han sido resueltas":"No se han generado alertas aún"})]})}):(0,b.jsx)("div",{className:"space-y-4",children:s.map(a=>{var c,r,s;let t,u=(c=a.alert_type,(t={inactivity_warning:{icon:(0,b.jsx)(p.Clock,{className:"w-5 h-5"}),color:"text-amber-600",bgColor:"bg-amber-50 border-amber-200",label:"Advertencia (30+ días)"},inactivity_critical:{icon:(0,b.jsx)(n.AlertTriangle,{className:"w-5 h-5"}),color:"text-orange-600",bgColor:"bg-orange-50 border-orange-200",label:"Crítico (60+ días)"},inactivity_dormant:{icon:(0,b.jsx)(o.AlertCircle,{className:"w-5 h-5"}),color:"text-red-600",bgColor:"bg-red-50 border-red-200",label:"Dormido (90+ días)"}})[c]||t.inactivity_warning);return(0,b.jsx)(x.Card,{className:`${u.bgColor} ${!a.is_read?"ring-2 ring-primary":""} ${a.is_resolved?"opacity-60":""}`,children:(0,b.jsxs)(x.CardContent,{className:"py-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:u.color,children:u.icon}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)(y.Badge,{variant:"outline",className:u.color,children:u.label}),!a.is_read&&(0,b.jsx)(y.Badge,{variant:"default",className:"text-xs",children:"Nuevo"}),a.is_resolved&&(0,b.jsxs)(y.Badge,{variant:"secondary",className:"text-xs",children:[(0,b.jsx)(q.CheckCircle,{className:"w-3 h-3 mr-1"}),"Resuelto"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(v.Building,{className:"w-4 h-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"font-medium",children:a.distributor?.company_name})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Días sin comprar:"}),(0,b.jsx)("p",{className:`font-bold ${u.color}`,children:a.days_since_purchase})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Última compra:"}),(0,b.jsx)("p",{className:"font-medium",children:a.last_purchase_date?(0,d.format)(new Date(a.last_purchase_date),"dd/MM/yyyy"):"Nunca"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Monto última:"}),(0,b.jsx)("p",{className:"font-medium",children:a.last_purchase_amount?`$${a.last_purchase_amount.toLocaleString()}`:"-"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Corredor:"}),(0,b.jsx)("p",{className:"font-medium",children:a.agent?.user_profiles?.full_name||"Sin asignar"})]})]}),a.resolution_notes&&(0,b.jsxs)("div",{className:"mt-3 p-2 bg-white/50 rounded text-sm",children:[(0,b.jsx)(w,{className:"w-3 h-3 inline mr-1"}),a.resolution_notes]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[!a.is_read&&(0,b.jsx)(z.Button,{variant:"ghost",size:"sm",onClick:()=>W(a.id),children:"Marcar leída"}),!a.is_resolved&&(0,b.jsxs)(z.Button,{variant:"outline",size:"sm",onClick:()=>{N(a),P(!0)},children:[(0,b.jsx)(q.CheckCircle,{className:"w-4 h-4 mr-1"}),"Resolver"]})]})]}),(0,b.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:["Creada ",(r=new Date(a.created_at),s={addSuffix:!0,locale:m.es},function(a,b,c){var d;let e,m=(0,g.getDefaultOptions)(),n=c?.locale??m.locale??f.defaultLocale,o=k(a,b);if(isNaN(o))throw RangeError("Invalid time value");let p=Object.assign({},c,{addSuffix:c?.addSuffix,comparison:o}),[q,r]=(0,i.normalizeDates)(c?.in,...o>0?[b,a]:[a,b]),s=(d=void 0,a=>{let b=(d?Math[d]:Math.trunc)(a);return 0===b?0:b})(((0,j.toDate)(r)-(0,j.toDate)(q))/1e3),t=Math.round((s-((0,h.getTimezoneOffsetInMilliseconds)(r)-(0,h.getTimezoneOffsetInMilliseconds)(q))/1e3)/60);if(t<2)if(c?.includeSeconds)if(s<5)return n.formatDistance("lessThanXSeconds",5,p);else if(s<10)return n.formatDistance("lessThanXSeconds",10,p);else if(s<20)return n.formatDistance("lessThanXSeconds",20,p);else if(s<40)return n.formatDistance("halfAMinute",0,p);else if(s<60)return n.formatDistance("lessThanXMinutes",1,p);else return n.formatDistance("xMinutes",1,p);else if(0===t)return n.formatDistance("lessThanXMinutes",1,p);else return n.formatDistance("xMinutes",t,p);if(t<45)return n.formatDistance("xMinutes",t,p);if(t<90)return n.formatDistance("aboutXHours",1,p);if(t<l.minutesInDay){let a=Math.round(t/60);return n.formatDistance("aboutXHours",a,p)}if(t<2520)return n.formatDistance("xDays",1,p);else if(t<l.minutesInMonth){let a=Math.round(t/l.minutesInDay);return n.formatDistance("xDays",a,p)}else if(t<2*l.minutesInMonth)return e=Math.round(t/l.minutesInMonth),n.formatDistance("aboutXMonths",e,p);if((e=function(a,b,c){var d,e;let f,g,h,l,[m,n,o]=(0,i.normalizeDates)(void 0,a,a,b),p=k(n,o),q=Math.abs(function(a,b,c){let[d,e]=(0,i.normalizeDates)(void 0,a,b);return 12*(d.getFullYear()-e.getFullYear())+(d.getMonth()-e.getMonth())}(n,o));if(q<1)return 0;1===n.getMonth()&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-p*q);let r=k(n,o)===-p;+(f=(0,j.toDate)(m,void 0),d=void 0,(g=(0,j.toDate)(f,d?.in)).setHours(23,59,59,999),g)==+(e=void 0,l=(h=(0,j.toDate)(f,e?.in)).getMonth(),h.setFullYear(h.getFullYear(),l+1,0),h.setHours(23,59,59,999),h)&&1===q&&1===k(m,o)&&(r=!1);let s=p*(q-r);return 0===s?0:s}(r,q))<12){let a=Math.round(t/l.minutesInMonth);return n.formatDistance("xMonths",a,p)}{let a=e%12,b=Math.trunc(e/12);return a<3?n.formatDistance("aboutXYears",b,p):a<9?n.formatDistance("overXYears",b,p):n.formatDistance("almostXYears",b+1,p)}}(r,(0,e.constructFrom)(r,Date.now()),s))]})]})},a.id)})}),(0,b.jsx)(B.Dialog,{open:O,onOpenChange:P,children:(0,b.jsxs)(B.DialogContent,{children:[(0,b.jsxs)(B.DialogHeader,{children:[(0,b.jsx)(B.DialogTitle,{children:"Resolver Alerta"}),(0,b.jsx)(B.DialogDescription,{children:"Marca esta alerta como resuelta y agrega notas opcionales"})]}),M&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,b.jsx)("p",{className:"font-medium",children:M.distributor?.company_name}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[M.days_since_purchase," días sin comprar"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Notas de resolución (opcional)"}),(0,b.jsx)(A.Textarea,{value:Q,onChange:a=>R(a.target.value),placeholder:"Ej: Se contactó al cliente, visitará la próxima semana...",className:"mt-1",rows:3})]})]}),(0,b.jsxs)(B.DialogFooter,{children:[(0,b.jsx)(z.Button,{variant:"outline",onClick:()=>P(!1),children:"Cancelar"}),(0,b.jsxs)(z.Button,{onClick:X,disabled:S,children:[S?(0,b.jsx)(r.RefreshCw,{className:"w-4 h-4 mr-2 animate-spin"}):(0,b.jsx)(q.CheckCircle,{className:"w-4 h-4 mr-2"}),"Resolver Alerta"]})]})]})})]})}a.s(["DistributorAlerts",()=>D],119192)}];

//# sourceMappingURL=components_admin_distributor-alerts_tsx_9bdc2292._.js.map