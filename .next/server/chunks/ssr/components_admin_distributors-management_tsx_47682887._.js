module.exports=[4391,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(69240),f=a.i(40695),g=a.i(5522),h=a.i(54161),i=a.i(88237),j=a.i(65733),k=a.i(5094),l=a.i(76504),m=a.i(17171),n=a.i(46893),o=a.i(87532),p=a.i(79360),q=a.i(99464),r=a.i(15618),s=a.i(81560),t=a.i(60246);function u(){let a=(0,d.useRouter)(),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)(!0),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)({email:"",full_name:"",phone:"",company_name:"",company_rif:"",business_type:"",discount_percentage:"0",credit_limit:"0",document_type:"CC",document_number:"",shipping_address:"",shipping_city:"",shipping_state:"",shipping_postal_code:"",shipping_country:"Colombia"});async function K(){let a=(0,e.createClient)(),{data:b,error:c}=await a.from("distributors").select(`
        *,
        profile:user_profiles(*)
      `).order("company_name",{ascending:!0});!c&&b&&v(await Promise.all(b.map(async b=>{let{count:c}=await a.from("companies").select("*",{count:"exact",head:!0}).eq("distribuidor_asignado_id",b.id);return{...b,clients_count:c||0}}))),z(!1)}async function L(){let a=(0,e.createClient)();try{if(G&&E){let{error:b}=await a.from("distributors").update({company_name:I.company_name,company_rif:I.company_rif,business_type:I.business_type,discount_percentage:Number.parseFloat(I.discount_percentage),credit_limit:Number.parseFloat(I.credit_limit)}).eq("id",E.id);if(b)throw b;let{error:c}=await a.from("user_profiles").update({full_name:I.full_name,phone:I.phone,document_type:I.document_type,document_number:I.document_number,shipping_address:I.shipping_address,shipping_city:I.shipping_city,shipping_state:I.shipping_state,shipping_postal_code:I.shipping_postal_code,shipping_country:I.shipping_country}).eq("id",E.user_id);if(c)throw c}else{let{data:b,error:c}=await a.auth.admin.createUser({email:I.email,email_confirm:!0,user_metadata:{full_name:I.full_name}});if(c)throw c;if(!b.user)throw Error("Failed to create user");let{error:d}=await a.from("user_profiles").insert({id:b.user.id,role:"distributor",full_name:I.full_name,phone:I.phone,document_type:I.document_type,document_number:I.document_number,shipping_address:I.shipping_address,shipping_city:I.shipping_city,shipping_state:I.shipping_state,shipping_postal_code:I.shipping_postal_code,shipping_country:I.shipping_country});if(d)throw d;let{error:e}=await a.from("distributors").insert({user_id:b.user.id,company_name:I.company_name,company_rif:I.company_rif,business_type:I.business_type,discount_percentage:Number.parseFloat(I.discount_percentage),credit_limit:Number.parseFloat(I.credit_limit)});if(e)throw e}await K(),B(!1)}catch(a){console.error("Error saving distributor:",a),alert("Error al guardar el distribuidor")}}async function M(){if(!E)return;let a=(0,e.createClient)();try{let{error:b}=await a.from("distributors").delete().eq("id",E.id);if(b)throw b;await K(),D(!1),F(null)}catch(a){console.error("Error deleting distributor:",a),alert("Error al eliminar el distribuidor")}}function N(b){a.push(`/admin/distributors/${b}/clients`)}async function O(a,b){let c=(0,e.createClient)(),{error:d}=await c.from("distributors").update({is_active:!b}).eq("id",a);d||await K()}(0,c.useEffect)(()=>{K()},[]);let P=u.filter(a=>a.company_name?.toLowerCase().includes(w.toLowerCase())||a.profile?.full_name?.toLowerCase().includes(w.toLowerCase())||a.profile?.phone?.includes(w)||a.company_rif?.includes(w));return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,b.jsx)(o.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"Buscar por nombre, empresa, RIF o teléfono...",value:w,onChange:a=>x(a.target.value),className:"pl-10"})]}),(0,b.jsxs)(f.Button,{onClick:function(){F(null),H(!1),J({email:"",full_name:"",phone:"",company_name:"",company_rif:"",business_type:"",discount_percentage:"0",credit_limit:"0",document_type:"CC",document_number:"",shipping_address:"",shipping_city:"",shipping_state:"",shipping_postal_code:"",shipping_country:"Colombia"}),B(!0)},className:"gap-2",children:[(0,b.jsx)(r.Plus,{className:"h-4 w-4"}),"Agregar Distribuidor"]})]}),(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{children:"Distribuidor"}),(0,b.jsx)(i.TableHead,{children:"Empresa"}),(0,b.jsx)(i.TableHead,{children:"Contacto"}),(0,b.jsx)(i.TableHead,{children:"Clientes Asignados"}),(0,b.jsx)(i.TableHead,{children:"Descuento"}),(0,b.jsx)(i.TableHead,{children:"Crédito"}),(0,b.jsx)(i.TableHead,{children:"Estado"}),(0,b.jsx)(i.TableHead,{className:"w-[50px]"})]})}),(0,b.jsx)(i.TableBody,{children:P.map(a=>(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableCell,{className:"font-medium",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{children:a.profile?.full_name||"Sin nombre"}),a.business_type&&(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:a.business_type})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{children:a.company_name}),a.company_rif&&(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["NIT: ",a.company_rif]})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{className:"space-y-1 text-sm",children:[a.profile?.phone&&(0,b.jsx)("div",{children:a.profile.phone}),a.profile?.id&&(0,b.jsx)("div",{className:"text-muted-foreground",children:"Email registrado"})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",className:"gap-2",onClick:()=>N(a.id),children:[(0,b.jsx)(t.Users,{className:"h-4 w-4"}),a.clients_count||0]})}),(0,b.jsxs)(i.TableCell,{children:[a.discount_percentage,"%"]}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"text-sm font-medium",children:["$",a.credit_limit?.toLocaleString()||"0"]}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Usado: $",a.current_balance?.toLocaleString()||"0"]})]})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsx)(h.Badge,{variant:a.is_active?"default":"secondary",children:a.is_active?"Activo":"Inactivo"})}),(0,b.jsx)(i.TableCell,{children:(0,b.jsxs)(l.DropdownMenu,{children:[(0,b.jsx)(l.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(p.MoreVertical,{className:"h-4 w-4"})})}),(0,b.jsxs)(l.DropdownMenuContent,{align:"end",children:[(0,b.jsxs)(l.DropdownMenuItem,{onClick:()=>N(a.id),children:[(0,b.jsx)(t.Users,{className:"mr-2 h-4 w-4"}),"Ver Clientes"]}),(0,b.jsxs)(l.DropdownMenuItem,{onClick:()=>{F(a),H(!0),J({email:"",full_name:a.profile?.full_name||"",phone:a.profile?.phone||"",company_name:a.company_name,company_rif:a.company_rif||"",business_type:a.business_type||"",discount_percentage:a.discount_percentage?.toString()||"0",credit_limit:a.credit_limit?.toString()||"0",document_type:a.profile?.document_type||"CC",document_number:a.profile?.document_number||"",shipping_address:a.profile?.shipping_address||"",shipping_city:a.profile?.shipping_city||"",shipping_state:a.profile?.shipping_state||"",shipping_postal_code:a.profile?.shipping_postal_code||"",shipping_country:a.profile?.shipping_country||"Colombia"}),B(!0)},children:[(0,b.jsx)(q.Pencil,{className:"mr-2 h-4 w-4"}),"Editar"]}),(0,b.jsx)(l.DropdownMenuItem,{onClick:()=>O(a.id,a.is_active),children:a.is_active?"Desactivar":"Activar"}),(0,b.jsxs)(l.DropdownMenuItem,{onClick:()=>{F(a),D(!0)},className:"text-destructive",children:[(0,b.jsx)(s.Trash2,{className:"mr-2 h-4 w-4"}),"Eliminar"]})]})]})})]},a.id))})]})}),(0,b.jsx)(j.Dialog,{open:A,onOpenChange:B,children:(0,b.jsxs)(j.DialogContent,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(j.DialogHeader,{children:[(0,b.jsx)(j.DialogTitle,{children:G?"Editar Distribuidor":"Crear Nuevo Distribuidor"}),(0,b.jsx)(j.DialogDescription,{children:G?"Actualiza la información del distribuidor":"Completa los datos para crear un nuevo distribuidor"})]}),(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[!G&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"email",children:"Email *"}),(0,b.jsx)(g.Input,{id:"email",type:"email",value:I.email,onChange:a=>J({...I,email:a.target.value}),placeholder:"distribuidor@empresa.com",required:!0})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"full_name",children:"Nombre Completo *"}),(0,b.jsx)(g.Input,{id:"full_name",value:I.full_name,onChange:a=>J({...I,full_name:a.target.value}),placeholder:"Juan Pérez",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"phone",children:"Teléfono"}),(0,b.jsx)(g.Input,{id:"phone",value:I.phone,onChange:a=>J({...I,phone:a.target.value}),placeholder:"+57 300 123 4567"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"document_type",children:"Tipo de Documento"}),(0,b.jsxs)("select",{id:"document_type",value:I.document_type,onChange:a=>J({...I,document_type:a.target.value}),className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",children:[(0,b.jsx)("option",{value:"CC",children:"CC"}),(0,b.jsx)("option",{value:"CE",children:"CE"}),(0,b.jsx)("option",{value:"Pasaporte",children:"Pasaporte"})]})]}),(0,b.jsxs)("div",{className:"space-y-2 col-span-2",children:[(0,b.jsx)(m.Label,{htmlFor:"document_number",children:"Número de Documento"}),(0,b.jsx)(g.Input,{id:"document_number",value:I.document_number,onChange:a=>J({...I,document_number:a.target.value}),placeholder:"123456789"})]})]}),(0,b.jsxs)("div",{className:"border-t pt-4",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold mb-4",children:"Información de la Empresa"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"company_name",children:"Nombre de la Empresa *"}),(0,b.jsx)(g.Input,{id:"company_name",value:I.company_name,onChange:a=>J({...I,company_name:a.target.value}),placeholder:"Distribuidora XYZ",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"company_rif",children:"NIT/RIF"}),(0,b.jsx)(g.Input,{id:"company_rif",value:I.company_rif,onChange:a=>J({...I,company_rif:a.target.value}),placeholder:"900123456-7"})]})]}),(0,b.jsxs)("div",{className:"space-y-2 mt-4",children:[(0,b.jsx)(m.Label,{htmlFor:"business_type",children:"Tipo de Negocio"}),(0,b.jsx)(g.Input,{id:"business_type",value:I.business_type,onChange:a=>J({...I,business_type:a.target.value}),placeholder:"Tienda, Restaurante, Hotel..."})]})]}),(0,b.jsxs)("div",{className:"border-t pt-4",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold mb-4",children:"Configuración Comercial"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"discount_percentage",children:"Descuento General (%)"}),(0,b.jsx)(g.Input,{id:"discount_percentage",type:"number",min:"0",max:"100",step:"0.01",value:I.discount_percentage,onChange:a=>J({...I,discount_percentage:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"credit_limit",children:"Límite de Crédito ($)"}),(0,b.jsx)(g.Input,{id:"credit_limit",type:"number",min:"0",step:"0.01",value:I.credit_limit,onChange:a=>J({...I,credit_limit:a.target.value})})]})]})]}),(0,b.jsxs)("div",{className:"border-t pt-4",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold mb-4",children:"Dirección de Envío"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"shipping_address",children:"Dirección"}),(0,b.jsx)(n.Textarea,{id:"shipping_address",value:I.shipping_address,onChange:a=>J({...I,shipping_address:a.target.value}),placeholder:"Calle 123 # 45-67",rows:2})]}),(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"shipping_city",children:"Ciudad"}),(0,b.jsx)(g.Input,{id:"shipping_city",value:I.shipping_city,onChange:a=>J({...I,shipping_city:a.target.value}),placeholder:"Bogotá"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"shipping_state",children:"Departamento"}),(0,b.jsx)(g.Input,{id:"shipping_state",value:I.shipping_state,onChange:a=>J({...I,shipping_state:a.target.value}),placeholder:"Cundinamarca"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"shipping_postal_code",children:"Código Postal"}),(0,b.jsx)(g.Input,{id:"shipping_postal_code",value:I.shipping_postal_code,onChange:a=>J({...I,shipping_postal_code:a.target.value}),placeholder:"110111"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"shipping_country",children:"País"}),(0,b.jsx)(g.Input,{id:"shipping_country",value:I.shipping_country,onChange:a=>J({...I,shipping_country:a.target.value}),placeholder:"Colombia"})]})]})]})]})]}),(0,b.jsxs)(j.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>B(!1),children:"Cancelar"}),(0,b.jsxs)(f.Button,{onClick:L,children:[G?"Actualizar":"Crear"," Distribuidor"]})]})]})}),(0,b.jsx)(k.AlertDialog,{open:C,onOpenChange:D,children:(0,b.jsxs)(k.AlertDialogContent,{children:[(0,b.jsxs)(k.AlertDialogHeader,{children:[(0,b.jsx)(k.AlertDialogTitle,{children:"¿Estás seguro?"}),(0,b.jsxs)(k.AlertDialogDescription,{children:["Esta acción no se puede deshacer. Se eliminará el distribuidor"," ",(0,b.jsx)("strong",{children:E?.company_name})," y toda su información asociada."]})]}),(0,b.jsxs)(k.AlertDialogFooter,{children:[(0,b.jsx)(k.AlertDialogCancel,{children:"Cancelar"}),(0,b.jsx)(k.AlertDialogAction,{onClick:M,className:"bg-destructive text-destructive-foreground",children:"Eliminar"})]})]})})]})}a.s(["DistributorsManagement",()=>u])}];

//# sourceMappingURL=components_admin_distributors-management_tsx_47682887._.js.map