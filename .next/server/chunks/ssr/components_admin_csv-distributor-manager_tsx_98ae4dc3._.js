module.exports=[353487,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(866965),e=a.i(773320),f=a.i(284505),g=a.i(624722),h=a.i(292e3),i=a.i(816201),j=a.i(862722),k=a.i(669520),l=a.i(797063),m=a.i(992258),n=a.i(340695),o=a.i(703130),p=a.i(265602),q=a.i(254161),r=a.i(602150),s=a.i(588237),t=a.i(887682),u=a.i(586547);function v(){let[a,v]=(0,c.useState)("upload"),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)("update"),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null),K=async a=>{if((a.headers.get("content-type")||"").includes("application/json"))return a.json();let b=await a.text(),c=401===a.status&&(b.includes("_vercel_sso_nonce")||b.toLowerCase().includes("vercel"));throw Error(`${c?"Vercel está bloqueando la ruta (Deployment Protection/SSO). Desactiva la protección del deployment o permite acceso público a /api/* y redeploy.":"La API devolvió una respuesta no-JSON."} (HTTP ${a.status})`)},L=(0,c.useCallback)(async a=>{let b=a[0];if(b){x(b),J(null),F(!0);try{let a=new FormData;a.append("file",b);let c=await fetch("/api/distributors/csv/validate",{method:"POST",body:a}),d=await K(c);if(!c.ok)throw Error(d.error||"Error al validar archivo");z(d),v("preview")}catch(a){J(a instanceof Error?a.message:"Error desconocido")}finally{F(!1)}}},[]),{getRootProps:M,getInputProps:N,isDragActive:O}=(0,d.useDropzone)({onDrop:L,accept:{"text/csv":[".csv"],"application/vnd.ms-excel":[".csv"]},maxFiles:1}),P=async()=>{if(w){H(!0),v("importing"),J(null);try{let a=new FormData;a.append("file",w),a.append("mode",C);let b=await fetch("/api/distributors/csv/import",{method:"POST",body:a}),c=await K(b);if(!b.ok)throw Error(c.error||"Error al importar archivo");B(c),v("complete")}catch(a){J(a instanceof Error?a.message:"Error desconocido"),v("preview")}finally{H(!1)}}},Q=()=>{v("upload"),x(null),z(null),B(null),J(null)},R=async a=>{window.open(a?"/api/distributors/csv/template?descriptions=true":"/api/distributors/csv/template","_blank")};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold",children:"Importación de Distribuidores"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Importa distribuidores masivamente desde un archivo CSV"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(n.Button,{variant:"outline",onClick:()=>R(!1),children:[(0,b.jsx)(f.Download,{className:"mr-2 h-4 w-4"}),"Plantilla Vacía"]}),(0,b.jsxs)(n.Button,{variant:"outline",onClick:()=>R(!0),children:[(0,b.jsx)(g.FileSpreadsheet,{className:"mr-2 h-4 w-4"}),"Plantilla con Instrucciones"]})]})]}),(0,b.jsxs)(p.Alert,{children:[(0,b.jsx)(l.Info,{className:"h-4 w-4"}),(0,b.jsx)(p.AlertTitle,{children:"Información importante"}),(0,b.jsx)(p.AlertDescription,{children:(0,b.jsxs)("ul",{className:"list-disc list-inside mt-2 space-y-1 text-sm",children:[(0,b.jsxs)("li",{children:["Los distribuidores se identifican por su ",(0,b.jsx)("strong",{children:"NIT/RIF (company_rif)"})]}),(0,b.jsxs)("li",{children:["Los nuevos distribuidores recibirán un ",(0,b.jsx)("strong",{children:"email de invitación"})," para configurar su contraseña"]}),(0,b.jsx)("li",{children:"Las direcciones de envío se gestionan por separado (cada distribuidor puede tener varias)"})]})})]}),I&&(0,b.jsxs)(p.Alert,{variant:"destructive",children:[(0,b.jsx)(h.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(p.AlertTitle,{children:"Error"}),(0,b.jsx)(p.AlertDescription,{children:I})]}),"upload"===a&&(0,b.jsxs)(o.Card,{children:[(0,b.jsxs)(o.CardHeader,{children:[(0,b.jsx)(o.CardTitle,{children:"Subir Archivo CSV"}),(0,b.jsx)(o.CardDescription,{children:"Arrastra un archivo CSV o haz clic para seleccionar"})]}),(0,b.jsx)(o.CardContent,{children:(0,b.jsxs)("div",{...M(),className:`border-2 border-dashed rounded-lg p-12 text-center cursor-pointer transition-colors
                ${O?"border-primary bg-primary/5":"border-muted-foreground/25 hover:border-primary/50"}`,children:[(0,b.jsx)("input",{...N()}),E?(0,b.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,b.jsx)(k.RefreshCw,{className:"h-12 w-12 animate-spin text-primary"}),(0,b.jsx)("p",{children:"Validando archivo..."})]}):(0,b.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,b.jsx)(e.Upload,{className:"h-12 w-12 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-lg font-medium",children:O?"Suelta el archivo aquí":"Arrastra tu archivo CSV aquí"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"o haz clic para seleccionar"})]})]})]})})]}),"preview"===a&&y&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:y.stats.total}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Total filas"})]})}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:y.stats.valid}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Válidas"})]})}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:y.stats.invalid}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Con errores"})]})}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:y.stats.toCreate}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"A crear"})]})}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-amber-600",children:y.stats.toUpdate}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"A actualizar"})]})}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-gray-500",children:y.stats.unchanged}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Sin cambios"})]})})]}),y.globalErrors.length>0&&(0,b.jsxs)(p.Alert,{variant:"destructive",children:[(0,b.jsx)(h.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(p.AlertTitle,{children:"Errores en el archivo"}),(0,b.jsx)(p.AlertDescription,{children:(0,b.jsx)("ul",{className:"list-disc list-inside mt-2",children:y.globalErrors.map((a,c)=>(0,b.jsx)("li",{children:a},c))})})]}),(0,b.jsxs)(o.Card,{children:[(0,b.jsxs)(o.CardHeader,{children:[(0,b.jsx)(o.CardTitle,{children:"Vista previa de datos"}),(0,b.jsx)(o.CardDescription,{children:y.hasMore&&"Mostrando los primeros 100 registros"})]}),(0,b.jsxs)(o.CardContent,{children:[(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(s.Table,{children:[(0,b.jsx)(s.TableHeader,{children:(0,b.jsxs)(s.TableRow,{children:[(0,b.jsx)(s.TableHead,{className:"w-16",children:"Fila"}),(0,b.jsx)(s.TableHead,{children:"Estado"}),(0,b.jsx)(s.TableHead,{children:"NIT/RIF"}),(0,b.jsx)(s.TableHead,{children:"Empresa"}),(0,b.jsx)(s.TableHead,{children:"Email"}),(0,b.jsx)(s.TableHead,{children:"Contacto"}),(0,b.jsx)(s.TableHead,{children:"Descuento"}),(0,b.jsx)(s.TableHead,{children:"Crédito"})]})}),(0,b.jsx)(s.TableBody,{children:y.distributors.map(a=>{let c=y.diffs.find(b=>b.companyRif===a.data.company_rif?.trim());return(0,b.jsxs)(s.TableRow,{className:a.isValid?"":"bg-red-50",children:[(0,b.jsx)(s.TableCell,{children:a.row}),(0,b.jsx)(s.TableCell,{children:a.isValid?c?.changeType==="create"?(0,b.jsx)(q.Badge,{className:"bg-blue-600",children:"Nuevo"}):c?.changeType==="update"?(0,b.jsx)(q.Badge,{className:"bg-amber-600",children:"Actualizar"}):(0,b.jsx)(q.Badge,{variant:"secondary",children:"Sin cambios"}):(0,b.jsx)(q.Badge,{variant:"destructive",children:"Error"})}),(0,b.jsx)(s.TableCell,{className:"font-mono text-sm",children:a.data.company_rif}),(0,b.jsx)(s.TableCell,{children:a.data.company_name}),(0,b.jsx)(s.TableCell,{children:a.data.email}),(0,b.jsx)(s.TableCell,{children:a.data.full_name}),(0,b.jsxs)(s.TableCell,{children:[a.data.discount_percentage,"%"]}),(0,b.jsxs)(s.TableCell,{children:["$",Number(a.data.credit_limit||0).toLocaleString()]})]},a.row)})})]})}),y.distributors.some(a=>a.errors.length>0)&&(0,b.jsx)(u.Accordion,{type:"single",collapsible:!0,className:"mt-4",children:(0,b.jsxs)(u.AccordionItem,{value:"errors",children:[(0,b.jsx)(u.AccordionTrigger,{className:"text-red-600",children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(j.XCircle,{className:"h-4 w-4"}),"Ver errores de validación (",y.stats.invalid," filas)"]})}),(0,b.jsx)(u.AccordionContent,{children:(0,b.jsx)("div",{className:"space-y-2",children:y.distributors.filter(a=>a.errors.length>0).map(a=>(0,b.jsxs)("div",{className:"p-3 bg-red-50 rounded-md",children:[(0,b.jsxs)("p",{className:"font-medium",children:["Fila ",a.row,": ",a.data.company_name||"Sin nombre"]}),(0,b.jsx)("ul",{className:"text-sm text-red-600 mt-1",children:a.errors.map((a,c)=>(0,b.jsxs)("li",{children:["• ",a.field,": ",a.message]},c))})]},a.row))})})]})})]})]}),(0,b.jsxs)(o.Card,{children:[(0,b.jsx)(o.CardHeader,{children:(0,b.jsx)(o.CardTitle,{children:"Opciones de importación"})}),(0,b.jsxs)(o.CardContent,{children:[(0,b.jsxs)("div",{className:"flex flex-wrap gap-4 items-end",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Modo de importación"}),(0,b.jsxs)(t.Select,{value:C,onValueChange:a=>D(a),children:[(0,b.jsx)(t.SelectTrigger,{className:"w-[250px]",children:(0,b.jsx)(t.SelectValue,{})}),(0,b.jsxs)(t.SelectContent,{children:[(0,b.jsx)(t.SelectItem,{value:"update",children:"Crear nuevos y actualizar existentes"}),(0,b.jsx)(t.SelectItem,{value:"add_only",children:"Solo crear nuevos"})]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(n.Button,{variant:"outline",onClick:Q,children:"Cancelar"}),(0,b.jsxs)(n.Button,{onClick:P,disabled:y.stats.invalid>0,children:[(0,b.jsx)(e.Upload,{className:"mr-2 h-4 w-4"}),"Importar ",y.stats.valid," distribuidores"]})]})]}),y.stats.invalid>0&&(0,b.jsx)("p",{className:"text-sm text-red-600 mt-2",children:"Corrige los errores antes de importar"})]})]})]}),"importing"===a&&(0,b.jsx)(o.Card,{children:(0,b.jsx)(o.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,b.jsx)(k.RefreshCw,{className:"h-12 w-12 animate-spin text-primary"}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-lg font-medium",children:"Importando distribuidores..."}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Por favor no cierres esta página"})]}),(0,b.jsx)(r.Progress,{value:50,className:"w-full max-w-md"})]})})}),"complete"===a&&A&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(p.Alert,{className:A.success?"border-green-500":"border-amber-500",children:[A.success?(0,b.jsx)(i.CheckCircle,{className:"h-4 w-4 text-green-500"}):(0,b.jsx)(h.AlertCircle,{className:"h-4 w-4 text-amber-500"}),(0,b.jsx)(p.AlertTitle,{children:A.success?"Importación completada":"Importación completada con errores"}),(0,b.jsx)(p.AlertDescription,{children:(0,b.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,b.jsxs)("p",{children:["• ",(0,b.jsx)("strong",{children:A.created})," distribuidores creados"]}),(0,b.jsxs)("p",{children:["• ",(0,b.jsx)("strong",{children:A.updated})," distribuidores actualizados"]}),(0,b.jsxs)("p",{children:["• ",(0,b.jsx)("strong",{children:A.skipped})," sin cambios/omitidos"]}),A.invited>0&&(0,b.jsxs)("p",{className:"flex items-center gap-1",children:[(0,b.jsx)(m.Mail,{className:"h-4 w-4"}),(0,b.jsx)("strong",{children:A.invited})," invitaciones enviadas por email"]}),A.errors.length>0&&(0,b.jsxs)("p",{className:"text-red-600",children:["• ",(0,b.jsx)("strong",{children:A.errors.length})," errores"]})]})})]}),A.errors.length>0&&(0,b.jsxs)(o.Card,{children:[(0,b.jsx)(o.CardHeader,{children:(0,b.jsx)(o.CardTitle,{className:"text-red-600",children:"Errores durante la importación"})}),(0,b.jsx)(o.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-2",children:[A.errors.map((a,c)=>(0,b.jsxs)("div",{className:"p-3 bg-red-50 rounded-md",children:[(0,b.jsxs)("p",{className:"font-medium",children:["Fila ",a.row,": ",a.companyRif]}),(0,b.jsx)("p",{className:"text-sm text-red-600",children:a.error})]},c)),A.hasMoreErrors&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Hay más errores que no se muestran aquí"})]})})]}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsxs)(n.Button,{onClick:Q,children:[(0,b.jsx)(k.RefreshCw,{className:"mr-2 h-4 w-4"}),"Nueva importación"]})})]})]})}a.s(["CSVDistributorManager",()=>v])}];

//# sourceMappingURL=components_admin_csv-distributor-manager_tsx_98ae4dc3._.js.map