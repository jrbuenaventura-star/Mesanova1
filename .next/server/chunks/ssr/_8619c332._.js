module.exports=[3130,a=>{"use strict";var b=a.i(87924),c=a.i(97895);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card",className:(0,c.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",a),...d})}function e({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-header",className:(0,c.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...d})}function f({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-title",className:(0,c.cn)("leading-none font-semibold",a),...d})}function g({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-description",className:(0,c.cn)("text-muted-foreground text-sm",a),...d})}function h({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-content",className:(0,c.cn)("px-6",a),...d})}function i({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-footer",className:(0,c.cn)("flex items-center px-6 [.border-t]:pt-6",a),...d})}a.s(["Card",()=>d,"CardContent",()=>h,"CardDescription",()=>g,"CardFooter",()=>i,"CardHeader",()=>e,"CardTitle",()=>f])},88237,a=>{"use strict";var b=a.i(87924),c=a.i(97895);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,b.jsx)("table",{"data-slot":"table",className:(0,c.cn)("w-full caption-bottom text-sm",a),...d})})}function e({className:a,...d}){return(0,b.jsx)("thead",{"data-slot":"table-header",className:(0,c.cn)("[&_tr]:border-b",a),...d})}function f({className:a,...d}){return(0,b.jsx)("tbody",{"data-slot":"table-body",className:(0,c.cn)("[&_tr:last-child]:border-0",a),...d})}function g({className:a,...d}){return(0,b.jsx)("tr",{"data-slot":"table-row",className:(0,c.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",a),...d})}function h({className:a,...d}){return(0,b.jsx)("th",{"data-slot":"table-head",className:(0,c.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...d})}function i({className:a,...d}){return(0,b.jsx)("td",{"data-slot":"table-cell",className:(0,c.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",a),...d})}a.s(["Table",()=>d,"TableBody",()=>f,"TableCell",()=>i,"TableHead",()=>h,"TableHeader",()=>e,"TableRow",()=>g])},46893,a=>{"use strict";var b=a.i(87924),c=a.i(97895);function d({className:a,...d}){return(0,b.jsx)("textarea",{"data-slot":"textarea",className:(0,c.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),...d})}a.s(["Textarea",()=>d])},34157,a=>{"use strict";let b=(0,a.i(70106).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["default",()=>b])},6406,a=>{"use strict";var b=a.i(34157);a.s(["CheckIcon",()=>b.default])},17171,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(30553),e=c.forwardRef((a,c)=>(0,b.jsx)(d.Primitive.label,{...a,ref:c,onMouseDown:b=>{b.target.closest("button, input, select, textarea")||(a.onMouseDown?.(b),!b.defaultPrevented&&b.detail>1&&b.preventDefault())}}));e.displayName="Label";var f=a.i(97895);function g({className:a,...c}){return(0,b.jsx)(e,{"data-slot":"label",className:(0,f.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",a),...c})}a.s(["Label",()=>g],17171)},3688,a=>{"use strict";var b=a.i(72131),c=a.i(72752);function d(a){let[d,e]=b.useState(void 0);return(0,c.useLayoutEffect)(()=>{if(a){e({width:a.offsetWidth,height:a.offsetHeight});let b=new ResizeObserver(b=>{let c,d;if(!Array.isArray(b)||!b.length)return;let f=b[0];if("borderBoxSize"in f){let a=f.borderBoxSize,b=Array.isArray(a)?a[0]:a;c=b.inlineSize,d=b.blockSize}else c=a.offsetWidth,d=a.offsetHeight;e({width:c,height:d})});return b.observe(a,{box:"border-box"}),()=>b.unobserve(a)}e(void 0)},[a]),d}a.s(["useSize",()=>d])},30656,a=>{"use strict";function b(a,[b,c]){return Math.min(c,Math.max(b,a))}a.s(["clamp",()=>b])},81560,a=>{"use strict";let b=(0,a.i(70106).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);a.s(["Trash2",()=>b],81560)},14548,a=>{"use strict";let b=(0,a.i(70106).default)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);a.s(["Save",()=>b],14548)},96079,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(69240),f=a.i(40695),g=a.i(5522),h=a.i(17171),i=a.i(87682),j=a.i(46893),k=a.i(3130),l=a.i(88237),m=a.i(81560),n=a.i(14548),o=a.i(71987);function p({distributorId:a,companies:p,products:q,userId:r}){let s=(0,d.useRouter)(),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(!1),D=(a,b)=>{b<1?E(a):w(c=>c.map(c=>c.product_id===a?{...c,quantity:b,subtotal:c.unit_price*b}:c))},E=a=>{w(b=>b.filter(b=>b.product_id!==a))},F=v.reduce((a,b)=>a+b.subtotal,0),G=.19*F,H=F+G,I=async()=>{if(!t)return void alert("Por favor selecciona un cliente");if(0===v.length)return void alert("Por favor agrega al menos un producto");C(!0);let b=(0,e.createClient)();try{let c=`ORD-${Date.now()}-${Math.random().toString(36).substr(2,9).toUpperCase()}`,{data:d,error:e}=await b.from("orders").insert({order_number:c,user_id:r,distributor_id:a,company_id:t,emisor:"Alumar SAS",fecha_pedido:new Date().toISOString().split("T")[0],status:"pending_approval",payment_status:"pending",subtotal:F,discount_amount:0,tax_amount:G,iva_porcentaje:19,shipping_cost:0,total:H,shipping_address:z||null,notes:x||null}).select().single();if(e)throw e;let f=v.map(a=>({order_id:d.id,product_id:a.product_id,product_code:a.product.pdt_codigo,product_name:a.product.nombre_comercial||a.product.pdt_descripcion,quantity:a.quantity,unit_price:a.unit_price,discount_percentage:0,discount_amount:0,subtotal:a.subtotal})),{error:g}=await b.from("order_items").insert(f);if(g)throw g;alert("Orden creada exitosamente"),s.push("/distributor/orders")}catch(a){console.error("[v0] Error creating order:",a),alert("Error al crear la orden")}finally{C(!1)}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(k.Card,{children:[(0,b.jsx)(k.CardHeader,{children:(0,b.jsx)(k.CardTitle,{children:"Información del Cliente"})}),(0,b.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"company",children:"Cliente *"}),(0,b.jsxs)(i.Select,{value:t,onValueChange:u,children:[(0,b.jsx)(i.SelectTrigger,{children:(0,b.jsx)(i.SelectValue,{placeholder:"Selecciona un cliente"})}),(0,b.jsx)(i.SelectContent,{children:p.map(a=>(0,b.jsxs)(i.SelectItem,{value:a.id,children:[a.razon_social," - NIT: ",a.nit]},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"address",children:"Dirección de Envío"}),(0,b.jsx)(g.Input,{id:"address",value:z,onChange:a=>A(a.target.value),placeholder:"Ingresa la dirección de envío"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"notes",children:"Notas e Instrucciones Especiales"}),(0,b.jsx)(j.Textarea,{id:"notes",value:x,onChange:a=>y(a.target.value),placeholder:"Comentarios adicionales sobre el pedido...",rows:3})]})]})]}),(0,b.jsxs)(k.Card,{children:[(0,b.jsx)(k.CardHeader,{children:(0,b.jsx)(k.CardTitle,{children:"Productos"})}),(0,b.jsxs)(k.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{children:"Agregar Producto"}),(0,b.jsxs)(i.Select,{onValueChange:a=>{let b=q.find(b=>b.id===a);if(!b||!b.precio)return;let c=v.find(b=>b.product_id===a);c?D(a,c.quantity+1):w([...v,{product_id:a,product:b,quantity:1,unit_price:b.precio,subtotal:b.precio}])},children:[(0,b.jsx)(i.SelectTrigger,{children:(0,b.jsx)(i.SelectValue,{placeholder:"Selecciona un producto"})}),(0,b.jsx)(i.SelectContent,{children:q.map(a=>(0,b.jsxs)(i.SelectItem,{value:a.id,children:[a.pdt_codigo," - ",a.nombre_comercial||a.pdt_descripcion," - $",a.precio?.toLocaleString()]},a.id))})]})]}),v.length>0&&(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(l.Table,{children:[(0,b.jsx)(l.TableHeader,{children:(0,b.jsxs)(l.TableRow,{children:[(0,b.jsx)(l.TableHead,{className:"w-[80px]",children:"Imagen"}),(0,b.jsx)(l.TableHead,{children:"SKU"}),(0,b.jsx)(l.TableHead,{children:"Descripción"}),(0,b.jsx)(l.TableHead,{children:"Precio Unit."}),(0,b.jsx)(l.TableHead,{children:"Cantidad"}),(0,b.jsx)(l.TableHead,{children:"Subtotal"}),(0,b.jsx)(l.TableHead,{className:"w-[80px]"})]})}),(0,b.jsx)(l.TableBody,{children:v.map(a=>(0,b.jsxs)(l.TableRow,{children:[(0,b.jsx)(l.TableCell,{children:(0,b.jsx)("div",{className:"relative h-12 w-12 overflow-hidden rounded-md border",children:a.product.imagen_principal_url?(0,b.jsx)(o.default,{src:a.product.imagen_principal_url||"/placeholder.svg",alt:a.product.nombre_comercial||a.product.pdt_descripcion,fill:!0,className:"object-cover"}):(0,b.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-muted text-xs",children:"Sin imagen"})})}),(0,b.jsx)(l.TableCell,{className:"font-mono",children:a.product.pdt_codigo}),(0,b.jsx)(l.TableCell,{children:a.product.nombre_comercial||a.product.pdt_descripcion}),(0,b.jsxs)(l.TableCell,{children:["$",a.unit_price.toLocaleString()]}),(0,b.jsx)(l.TableCell,{children:(0,b.jsx)(g.Input,{type:"number",min:"1",value:a.quantity,onChange:b=>D(a.product_id,Number.parseInt(b.target.value)),className:"w-20"})}),(0,b.jsxs)(l.TableCell,{className:"font-medium",children:["$",a.subtotal.toLocaleString()]}),(0,b.jsx)(l.TableCell,{children:(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:()=>E(a.product_id),children:(0,b.jsx)(m.Trash2,{className:"h-4 w-4 text-destructive"})})})]},a.product_id))})]})})]})]}),v.length>0&&(0,b.jsxs)(k.Card,{children:[(0,b.jsx)(k.CardHeader,{children:(0,b.jsx)(k.CardTitle,{children:"Resumen de la Orden"})}),(0,b.jsx)(k.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{children:"Subtotal:"}),(0,b.jsxs)("span",{className:"font-medium",children:["$",F.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsxs)("span",{children:["IVA (",19,"%):"]}),(0,b.jsxs)("span",{className:"font-medium",children:["$",G.toLocaleString()]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[(0,b.jsx)("span",{children:"Total:"}),(0,b.jsxs)("span",{children:["$",H.toLocaleString()]})]})]})})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>s.back(),disabled:B,children:"Cancelar"}),(0,b.jsxs)(f.Button,{onClick:I,disabled:B||0===v.length,children:[(0,b.jsx)(n.Save,{className:"mr-2 h-4 w-4"}),B?"Creando...":"Crear Orden"]})]})]})}a.s(["default",()=>p])}];

//# sourceMappingURL=_8619c332._.js.map