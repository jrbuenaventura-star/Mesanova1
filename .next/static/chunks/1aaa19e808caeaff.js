(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,470152,e=>{"use strict";function s(e,[s,a]){return Math.min(a,Math.max(s,e))}e.s(["clamp",()=>s])},947627,e=>{"use strict";var s=e.i(843476),a=e.i(647163);function t({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,s.jsx)("table",{"data-slot":"table",className:(0,a.cn)("w-full caption-bottom text-sm",e),...t})})}function r({className:e,...t}){return(0,s.jsx)("thead",{"data-slot":"table-header",className:(0,a.cn)("[&_tr]:border-b",e),...t})}function l({className:e,...t}){return(0,s.jsx)("tbody",{"data-slot":"table-body",className:(0,a.cn)("[&_tr:last-child]:border-0",e),...t})}function n({className:e,...t}){return(0,s.jsx)("tfoot",{"data-slot":"table-footer",className:(0,a.cn)("bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",e),...t})}function i({className:e,...t}){return(0,s.jsx)("tr",{"data-slot":"table-row",className:(0,a.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...t})}function c({className:e,...t}){return(0,s.jsx)("th",{"data-slot":"table-head",className:(0,a.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}function d({className:e,...t}){return(0,s.jsx)("td",{"data-slot":"table-cell",className:(0,a.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}function o({className:e,...t}){return(0,s.jsx)("caption",{"data-slot":"table-caption",className:(0,a.cn)("text-muted-foreground mt-4 text-sm",e),...t})}e.s(["Table",()=>t,"TableBody",()=>l,"TableCaption",()=>o,"TableCell",()=>d,"TableFooter",()=>n,"TableHead",()=>c,"TableHeader",()=>r,"TableRow",()=>i])},269638,e=>{"use strict";let s=(0,e.i(475254).default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>s],269638)},287336,e=>{"use strict";var s=e.i(843476),a=e.i(271645),t=e.i(30030),r=e.i(248425),l="Progress",[n,i]=(0,t.createContextScope)(l),[c,d]=n(l),o=a.forwardRef((e,a)=>{var t,l;let{__scopeProgress:n,value:i=null,max:d,getValueLabel:o=h,...x}=e;(d||0===d)&&!j(d)&&console.error((t=`${d}`,`Invalid prop \`max\` of value \`${t}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let m=j(d)?d:100;null===i||v(i,m)||console.error((l=`${i}`,`Invalid prop \`value\` of value \`${l}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let f=v(i,m)?i:null,g=p(f)?o(f,m):void 0;return(0,s.jsx)(c,{scope:n,value:f,max:m,children:(0,s.jsx)(r.Primitive.div,{"aria-valuemax":m,"aria-valuemin":0,"aria-valuenow":p(f)?f:void 0,"aria-valuetext":g,role:"progressbar","data-state":u(f,m),"data-value":f??void 0,"data-max":m,...x,ref:a})})});o.displayName=l;var x="ProgressIndicator",m=a.forwardRef((e,a)=>{let{__scopeProgress:t,...l}=e,n=d(x,t);return(0,s.jsx)(r.Primitive.div,{"data-state":u(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...l,ref:a})});function h(e,s){return`${Math.round(e/s*100)}%`}function u(e,s){return null==e?"indeterminate":e===s?"complete":"loading"}function p(e){return"number"==typeof e}function j(e){return p(e)&&!isNaN(e)&&e>0}function v(e,s){return p(e)&&!isNaN(e)&&e<=s&&e>=0}m.displayName=x;var f=e.i(647163);function g({className:e,value:a,...t}){return(0,s.jsx)(o,{"data-slot":"progress",className:(0,f.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",e),...t,children:(0,s.jsx)(m,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(a||0)}%)`}})})}e.s(["Progress",()=>g],287336)},569074,e=>{"use strict";let s=(0,e.i(475254).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>s],569074)},232189,(e,s,a)=>{"use strict";s.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},865156,(e,s,a)=>{"use strict";var t=e.r(232189);function r(){}function l(){}l.resetWarningCache=r,s.exports=function(){function e(e,s,a,r,l,n){if(n!==t){var i=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function s(){return e}e.isRequired=e;var a={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:s,element:e,elementType:e,instanceOf:s,node:e,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:l,resetWarningCache:r};return a.PropTypes=a,a}},745009,(e,s,a)=>{s.exports=e.r(865156)()},440160,e=>{"use strict";let s=(0,e.i(475254).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);e.s(["Download",()=>s],440160)},781947,e=>{"use strict";var s=e.i(843476),a=e.i(225913),t=e.i(647163);let r=(0,a.cva)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function l({className:e,variant:a,...l}){return(0,s.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,t.cn)(r({variant:a}),e),...l})}function n({className:e,...a}){return(0,s.jsx)("div",{"data-slot":"alert-title",className:(0,t.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",e),...a})}function i({className:e,...a}){return(0,s.jsx)("div",{"data-slot":"alert-description",className:(0,t.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",e),...a})}e.s(["Alert",()=>l,"AlertDescription",()=>i,"AlertTitle",()=>n])},373884,e=>{"use strict";let s=(0,e.i(475254).default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>s],373884)},178583,e=>{"use strict";let s=(0,e.i(475254).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>s],178583)},190427,e=>{"use strict";var s=e.i(843476),a=e.i(271645),t=e.i(510665),r=e.i(569074),l=e.i(440160),n=e.i(294918),i=e.i(63209),c=e.i(269638),d=e.i(373884),o=e.i(16715),x=e.i(178583),m=e.i(952571),h=e.i(167881),u=e.i(970065),p=e.i(781947),j=e.i(994179),v=e.i(287336),f=e.i(947627),g=e.i(62870),b=e.i(890538),N=e.i(127341);function C(){let[e,C]=(0,a.useState)("upload"),[y,T]=(0,a.useState)(null),[w,S]=(0,a.useState)(null),[k,_]=(0,a.useState)(null),[A,P]=(0,a.useState)("update"),[H,R]=(0,a.useState)(!1),[E,I]=(0,a.useState)(!1),[M,V]=(0,a.useState)(null),B=async e=>{if((e.headers.get("content-type")||"").includes("application/json"))return e.json();let s=await e.text(),a=401===e.status&&(s.includes("_vercel_sso_nonce")||s.toLowerCase().includes("vercel"));throw Error(`${a?"Vercel está bloqueando la ruta (Deployment Protection/SSO). Desactiva la protección del deployment o permite acceso público a /api/* y redeploy.":"La API devolvió una respuesta no-JSON."} (HTTP ${e.status})`)},z=(0,a.useCallback)(async e=>{let s=e[0];if(s){T(s),V(null),R(!0);try{let e=new FormData;e.append("file",s);let a=await fetch("/api/products/csv/validate",{method:"POST",body:e}),t=await B(a);if(!a.ok)throw Error(t.error||"Error al validar archivo");S(t),C("preview")}catch(e){V(e instanceof Error?e.message:"Error desconocido")}finally{R(!1)}}},[]),{getRootProps:O,getInputProps:D,isDragActive:F}=(0,t.useDropzone)({onDrop:z,accept:{"text/csv":[".csv"],"application/vnd.ms-excel":[".csv"]},maxFiles:1}),U=async()=>{if(y){I(!0),C("importing"),V(null);try{let e=new FormData;e.append("file",y),e.append("mode",A);let s=await fetch("/api/products/csv/import",{method:"POST",body:e}),a=await B(s);if(!s.ok)throw Error(a.error||"Error al importar archivo");_(a),C("complete")}catch(e){V(e instanceof Error?e.message:"Error desconocido"),C("preview")}finally{I(!1)}}},L=()=>{C("upload"),T(null),S(null),_(null),V(null)},$=async e=>{window.open(e?"/api/products/csv/template?descriptions=true":"/api/products/csv/template","_blank")},q=async()=>{window.open("/api/products/csv/export","_blank")};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-4 justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:"Gestión de Productos CSV"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Importa, exporta y sincroniza productos masivamente"})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(h.Button,{variant:"outline",onClick:()=>$(!1),children:[(0,s.jsx)(l.Download,{className:"w-4 h-4 mr-2"}),"Template vacío"]}),(0,s.jsxs)(h.Button,{variant:"outline",onClick:()=>$(!0),children:[(0,s.jsx)(x.FileText,{className:"w-4 h-4 mr-2"}),"Template con instrucciones"]}),(0,s.jsxs)(h.Button,{variant:"secondary",onClick:q,children:[(0,s.jsx)(n.FileSpreadsheet,{className:"w-4 h-4 mr-2"}),"Exportar productos"]})]})]}),M&&(0,s.jsxs)(p.Alert,{variant:"destructive",children:[(0,s.jsx)(i.AlertCircle,{className:"h-4 w-4"}),(0,s.jsx)(p.AlertTitle,{children:"Error"}),(0,s.jsx)(p.AlertDescription,{children:M})]}),"upload"===e&&(0,s.jsxs)(u.Card,{children:[(0,s.jsxs)(u.CardHeader,{children:[(0,s.jsx)(u.CardTitle,{children:"Subir archivo CSV"}),(0,s.jsx)(u.CardDescription,{children:"Arrastra un archivo CSV o haz clic para seleccionarlo"})]}),(0,s.jsxs)(u.CardContent,{children:[(0,s.jsxs)("div",{...O(),className:`
                border-2 border-dashed rounded-lg p-12 text-center cursor-pointer
                transition-colors
                ${F?"border-primary bg-primary/5":"border-muted-foreground/25"}
                ${H?"opacity-50 pointer-events-none":""}
              `,children:[(0,s.jsx)("input",{...D()}),H?(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)(o.RefreshCw,{className:"w-12 h-12 animate-spin text-primary"}),(0,s.jsx)("p",{className:"text-lg",children:"Validando archivo..."})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)(r.Upload,{className:"w-12 h-12 text-muted-foreground"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-lg font-medium",children:F?"Suelta el archivo aquí":"Arrastra un archivo CSV aquí"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"o haz clic para seleccionar"})]})]})]}),(0,s.jsx)("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)(m.Info,{className:"w-5 h-5 text-blue-500 mt-0.5"}),(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"Información importante:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-muted-foreground",children:[(0,s.jsx)("li",{children:"El archivo debe estar en formato CSV con codificación UTF-8"}),(0,s.jsx)("li",{children:"Los campos obligatorios son: Ref, Producto, Precio_COP"}),(0,s.jsx)("li",{children:"Las imágenes deben ser URLs válidas"}),(0,s.jsx)("li",{children:"Los productos existentes se identifican por la columna Ref"})]})]})]})})]})]}),"preview"===e&&w&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[(0,s.jsx)(u.Card,{children:(0,s.jsxs)(u.CardContent,{className:"pt-6",children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:w.stats.total}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total filas"})]})}),(0,s.jsx)(u.Card,{children:(0,s.jsxs)(u.CardContent,{className:"pt-6",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:w.stats.valid}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Válidas"})]})}),(0,s.jsx)(u.Card,{children:(0,s.jsxs)(u.CardContent,{className:"pt-6",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-red-600",children:w.stats.invalid}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Con errores"})]})}),(0,s.jsx)(u.Card,{children:(0,s.jsxs)(u.CardContent,{className:"pt-6",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:w.stats.toCreate}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Nuevos"})]})}),(0,s.jsx)(u.Card,{children:(0,s.jsxs)(u.CardContent,{className:"pt-6",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-amber-600",children:w.stats.toUpdate}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"A actualizar"})]})}),(0,s.jsx)(u.Card,{children:(0,s.jsxs)(u.CardContent,{className:"pt-6",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:w.stats.unchanged}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Sin cambios"})]})})]}),w.globalErrors.length>0&&(0,s.jsxs)(p.Alert,{variant:"destructive",children:[(0,s.jsx)(i.AlertCircle,{className:"h-4 w-4"}),(0,s.jsx)(p.AlertTitle,{children:"Problemas con el archivo"}),(0,s.jsx)(p.AlertDescription,{children:(0,s.jsx)("ul",{className:"list-disc list-inside mt-2",children:w.globalErrors.map((e,a)=>(0,s.jsx)("li",{children:e},a))})})]}),(0,s.jsxs)(N.Tabs,{defaultValue:"changes",children:[(0,s.jsxs)(N.TabsList,{children:[(0,s.jsxs)(N.TabsTrigger,{value:"changes",children:["Cambios (",w.stats.toCreate+w.stats.toUpdate,")"]}),(0,s.jsxs)(N.TabsTrigger,{value:"errors",children:["Errores (",w.stats.invalid,")"]}),(0,s.jsx)(N.TabsTrigger,{value:"all",children:"Todos los productos"})]}),(0,s.jsx)(N.TabsContent,{value:"changes",className:"mt-4",children:(0,s.jsx)(u.Card,{children:(0,s.jsx)(u.CardContent,{className:"pt-6",children:(0,s.jsx)("div",{className:"max-h-96 overflow-auto",children:(0,s.jsxs)(f.Table,{children:[(0,s.jsx)(f.TableHeader,{children:(0,s.jsxs)(f.TableRow,{children:[(0,s.jsx)(f.TableHead,{children:"Ref"}),(0,s.jsx)(f.TableHead,{children:"Acción"}),(0,s.jsx)(f.TableHead,{children:"Campos modificados"})]})}),(0,s.jsx)(f.TableBody,{children:w.diffs.filter(e=>"unchanged"!==e.changeType).map(e=>(0,s.jsxs)(f.TableRow,{children:[(0,s.jsx)(f.TableCell,{className:"font-mono",children:e.ref}),(0,s.jsx)(f.TableCell,{children:(0,s.jsx)(j.Badge,{variant:"create"===e.changeType?"default":"secondary",children:"create"===e.changeType?"Nuevo":"Actualizar"})}),(0,s.jsx)(f.TableCell,{children:"create"===e.changeType?(0,s.jsx)("span",{className:"text-muted-foreground",children:"Producto nuevo"}):(0,s.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.changes.slice(0,5).map(e=>(0,s.jsx)(j.Badge,{variant:"outline",children:e.field},e.field)),e.changes.length>5&&(0,s.jsxs)(j.Badge,{variant:"outline",children:["+",e.changes.length-5," más"]})]})})]},e.ref))})]})})})})}),(0,s.jsx)(N.TabsContent,{value:"errors",className:"mt-4",children:(0,s.jsx)(u.Card,{children:(0,s.jsx)(u.CardContent,{className:"pt-6",children:0===w.stats.invalid?(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(c.CheckCircle,{className:"w-12 h-12 mx-auto mb-4 text-green-500"}),(0,s.jsx)("p",{children:"No hay errores de validación"})]}):(0,s.jsx)(b.Accordion,{type:"single",collapsible:!0,className:"w-full",children:w.products.filter(e=>!e.isValid).map(e=>(0,s.jsxs)(b.AccordionItem,{value:`row-${e.row}`,children:[(0,s.jsx)(b.AccordionTrigger,{children:(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(d.XCircle,{className:"w-4 h-4 text-red-500"}),(0,s.jsxs)("span",{children:["Fila ",e.row]}),(0,s.jsx)("span",{className:"font-mono text-sm",children:e.data.Ref||"(sin referencia)"}),(0,s.jsxs)(j.Badge,{variant:"destructive",children:[e.errors.length," error(es)"]})]})}),(0,s.jsx)(b.AccordionContent,{children:(0,s.jsx)("ul",{className:"space-y-2 pl-8",children:e.errors.map((e,a)=>(0,s.jsxs)("li",{className:"text-sm",children:[(0,s.jsxs)("span",{className:"font-medium",children:[e.field,":"]})," ",e.message,e.value&&(0,s.jsxs)("span",{className:"text-muted-foreground",children:[" ",'(valor: "',e.value,'")']})]},a))})})]},e.row))})})})}),(0,s.jsx)(N.TabsContent,{value:"all",className:"mt-4",children:(0,s.jsx)(u.Card,{children:(0,s.jsxs)(u.CardContent,{className:"pt-6",children:[(0,s.jsx)("div",{className:"max-h-96 overflow-auto",children:(0,s.jsxs)(f.Table,{children:[(0,s.jsx)(f.TableHeader,{children:(0,s.jsxs)(f.TableRow,{children:[(0,s.jsx)(f.TableHead,{children:"Fila"}),(0,s.jsx)(f.TableHead,{children:"Ref"}),(0,s.jsx)(f.TableHead,{children:"Producto"}),(0,s.jsx)(f.TableHead,{children:"Precio"}),(0,s.jsx)(f.TableHead,{children:"Estado"})]})}),(0,s.jsx)(f.TableBody,{children:w.products.map(e=>(0,s.jsxs)(f.TableRow,{children:[(0,s.jsx)(f.TableCell,{children:e.row}),(0,s.jsx)(f.TableCell,{className:"font-mono",children:e.data.Ref}),(0,s.jsx)(f.TableCell,{className:"max-w-xs truncate",children:e.data.Producto}),(0,s.jsxs)(f.TableCell,{children:["$",Number(e.data.Precio_COP||0).toLocaleString()]}),(0,s.jsx)(f.TableCell,{children:e.isValid?(0,s.jsxs)(j.Badge,{variant:"outline",className:"text-green-600",children:[(0,s.jsx)(c.CheckCircle,{className:"w-3 h-3 mr-1"}),"Válido"]}):(0,s.jsxs)(j.Badge,{variant:"destructive",children:[(0,s.jsx)(d.XCircle,{className:"w-3 h-3 mr-1"}),e.errors.length," error(es)"]})})]},e.row))})]})}),w.hasMore&&(0,s.jsx)("p",{className:"text-center text-sm text-muted-foreground mt-4",children:"Mostrando los primeros 100 productos..."})]})})})]}),(0,s.jsxs)(u.Card,{children:[(0,s.jsx)(u.CardHeader,{children:(0,s.jsx)(u.CardTitle,{children:"Opciones de importación"})}),(0,s.jsx)(u.CardContent,{children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-6 items-start md:items-end",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium mb-2 block",children:"Modo de importación"}),(0,s.jsxs)(g.Select,{value:A,onValueChange:e=>P(e),children:[(0,s.jsx)(g.SelectTrigger,{className:"w-full md:w-64",children:(0,s.jsx)(g.SelectValue,{})}),(0,s.jsxs)(g.SelectContent,{children:[(0,s.jsx)(g.SelectItem,{value:"update",children:"Actualizar existentes y crear nuevos"}),(0,s.jsx)(g.SelectItem,{value:"add_only",children:"Solo agregar nuevos"}),(0,s.jsx)(g.SelectItem,{value:"replace_all",children:"Reemplazar toda la base (peligroso)"})]})]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["update"===A&&"Los productos existentes se actualizarán con los nuevos valores","add_only"===A&&"Solo se crearán productos nuevos, los existentes no se modificarán","replace_all"===A&&"⚠️ Todos los productos serán reemplazados"]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(h.Button,{variant:"outline",onClick:L,children:"Cancelar"}),(0,s.jsx)(h.Button,{onClick:U,disabled:w.stats.invalid>0,children:w.stats.invalid>0?"Corrige los errores primero":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Upload,{className:"w-4 h-4 mr-2"}),"Importar ",w.stats.valid," productos"]})})]})]})})]})]}),"importing"===e&&(0,s.jsx)(u.Card,{children:(0,s.jsx)(u.CardContent,{className:"py-12",children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-6",children:[(0,s.jsx)(o.RefreshCw,{className:"w-16 h-16 animate-spin text-primary"}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h3",{className:"text-xl font-bold mb-2",children:"Importando productos..."}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Por favor espera mientras se procesan los productos"})]}),(0,s.jsx)(v.Progress,{value:33,className:"w-64"})]})})}),"complete"===e&&k&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(p.Alert,{variant:k.success?"default":"destructive",children:[k.success?(0,s.jsx)(c.CheckCircle,{className:"h-4 w-4"}):(0,s.jsx)(i.AlertCircle,{className:"h-4 w-4"}),(0,s.jsx)(p.AlertTitle,{children:k.success?"Importación completada":"Importación completada con errores"}),(0,s.jsxs)(p.AlertDescription,{children:["Se procesaron ",k.created+k.updated+k.skipped," ","productos"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,s.jsx)(u.Card,{children:(0,s.jsxs)(u.CardContent,{className:"pt-6",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:k.created}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Creados"})]})}),(0,s.jsx)(u.Card,{children:(0,s.jsxs)(u.CardContent,{className:"pt-6",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:k.updated}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Actualizados"})]})}),(0,s.jsx)(u.Card,{children:(0,s.jsxs)(u.CardContent,{className:"pt-6",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:k.skipped}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Omitidos"})]})}),(0,s.jsx)(u.Card,{children:(0,s.jsxs)(u.CardContent,{className:"pt-6",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-red-600",children:k.errors.length}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Errores"})]})})]}),k.errors.length>0&&(0,s.jsxs)(u.Card,{children:[(0,s.jsx)(u.CardHeader,{children:(0,s.jsx)(u.CardTitle,{className:"text-red-600",children:"Errores durante la importación"})}),(0,s.jsxs)(u.CardContent,{children:[(0,s.jsxs)(f.Table,{children:[(0,s.jsx)(f.TableHeader,{children:(0,s.jsxs)(f.TableRow,{children:[(0,s.jsx)(f.TableHead,{children:"Fila"}),(0,s.jsx)(f.TableHead,{children:"Ref"}),(0,s.jsx)(f.TableHead,{children:"Error"})]})}),(0,s.jsx)(f.TableBody,{children:k.errors.map((e,a)=>(0,s.jsxs)(f.TableRow,{children:[(0,s.jsx)(f.TableCell,{children:e.row}),(0,s.jsx)(f.TableCell,{className:"font-mono",children:e.ref}),(0,s.jsx)(f.TableCell,{children:e.error})]},a))})]}),k.hasMoreErrors&&(0,s.jsx)("p",{className:"text-center text-sm text-muted-foreground mt-4",children:"Mostrando los primeros 20 errores..."})]})]}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsxs)(h.Button,{onClick:L,children:[(0,s.jsx)(o.RefreshCw,{className:"w-4 h-4 mr-2"}),"Nueva importación"]})})]})]})}e.s(["CSVProductManager",()=>C])},622998,e=>{"use strict";var s=e.i(843476),a=e.i(271645),t=e.i(401851),r=e.i(564211),l=e.i(475254);let n=(0,l.default)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);var i=e.i(294918);let c=(0,l.default)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);var d=e.i(284614);let o=(0,l.default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var x=e.i(970065),m=e.i(994179),h=e.i(167881),u=e.i(23750),p=e.i(62870),j=e.i(890538),v=e.i(947627);function f({productId:e}){let[l,f]=(0,a.useState)([]),[g,b]=(0,a.useState)(!0),[N,C]=(0,a.useState)("all"),[y,T]=(0,a.useState)("all"),[w,S]=(0,a.useState)(""),[k,_]=(0,a.useState)(""),[A,P]=(0,a.useState)(!1),[H,R]=(0,a.useState)(0),E=async(s=!1)=>{b(!0);let a=s?0:H;try{let t=new URLSearchParams;e&&t.set("product_id",e),"all"!==N&&t.set("change_type",N),w&&t.set("start_date",w),k&&t.set("end_date",k),t.set("limit","20"),t.set("offset",a.toString());let r=await fetch(`/api/products/csv/changelog?${t}`),l=await r.json();s?f(l.logs||[]):f(e=>[...e,...l.logs||[]]),P(l.hasMore),R(a+20)}catch(e){console.error("Error fetching changelog:",e)}finally{b(!1)}};return(0,a.useEffect)(()=>{E(!0)},[e,N,y,w,k]),(0,s.jsxs)(x.Card,{children:[(0,s.jsx)(x.CardHeader,{children:(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)(x.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(n,{className:"w-5 h-5"}),"Historial de Cambios"]})})}),(0,s.jsxs)(x.CardContent,{children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(o,{className:"w-4 h-4 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Filtros:"})]}),(0,s.jsxs)(p.Select,{value:N,onValueChange:C,children:[(0,s.jsx)(p.SelectTrigger,{className:"w-40",children:(0,s.jsx)(p.SelectValue,{placeholder:"Tipo de cambio"})}),(0,s.jsxs)(p.SelectContent,{children:[(0,s.jsx)(p.SelectItem,{value:"all",children:"Todos"}),(0,s.jsx)(p.SelectItem,{value:"create",children:"Creación"}),(0,s.jsx)(p.SelectItem,{value:"update",children:"Actualización"}),(0,s.jsx)(p.SelectItem,{value:"csv_import",children:"CSV Import"}),(0,s.jsx)(p.SelectItem,{value:"erp_sync",children:"ERP Sync"})]})]}),(0,s.jsx)(u.Input,{type:"date",value:w,onChange:e=>S(e.target.value),className:"w-40",placeholder:"Desde"}),(0,s.jsx)(u.Input,{type:"date",value:k,onChange:e=>_(e.target.value),className:"w-40",placeholder:"Hasta"})]}),g&&0===l.length?(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando historial..."}):0===l.length?(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No hay cambios registrados"}):(0,s.jsx)(j.Accordion,{type:"single",collapsible:!0,className:"w-full",children:l.map(a=>{var l;return(0,s.jsxs)(j.AccordionItem,{value:a.id,children:[(0,s.jsx)(j.AccordionTrigger,{children:(0,s.jsxs)("div",{className:"flex items-center gap-4 flex-1 text-left",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:(0,t.format)(new Date(a.changed_at),"dd MMM yyyy HH:mm",{locale:r.es})}),(0,s.jsx)(m.Badge,{variant:{create:"default",update:"secondary",csv_import:"outline",erp_sync:"outline"}[a.change_type]||"outline",children:{create:"Creación",update:"Actualización",csv_import:"Importación CSV",erp_sync:"Sincronización ERP"}[l=a.change_type]||l}),!e&&a.product&&(0,s.jsx)("span",{className:"font-mono text-sm",children:a.product.pdt_codigo}),(0,s.jsxs)("span",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[(e=>{switch(e){case"csv":return(0,s.jsx)(i.FileSpreadsheet,{className:"w-4 h-4"});case"erp":return(0,s.jsx)(c,{className:"w-4 h-4"});case"admin":return(0,s.jsx)(d.User,{className:"w-4 h-4"});default:return null}})(a.change_source),a.change_source]})]})}),(0,s.jsx)(j.AccordionContent,{children:(0,s.jsxs)("div",{className:"pl-4 space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm",children:[a.user&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Usuario:"})," ",a.user.full_name]}),a.csv_filename&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Archivo:"})," ",a.csv_filename]}),a.csv_row_number&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Fila:"})," ",a.csv_row_number]})]}),"create"===a.change_type?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Producto creado"}):(0,s.jsxs)(v.Table,{children:[(0,s.jsx)(v.TableHeader,{children:(0,s.jsxs)(v.TableRow,{children:[(0,s.jsx)(v.TableHead,{children:"Campo"}),(0,s.jsx)(v.TableHead,{children:"Valor anterior"}),(0,s.jsx)(v.TableHead,{children:"Nuevo valor"})]})}),(0,s.jsx)(v.TableBody,{children:Object.entries(a.fields_changed).map(([e,a])=>(0,s.jsxs)(v.TableRow,{children:[(0,s.jsx)(v.TableCell,{className:"font-medium",children:e}),(0,s.jsx)(v.TableCell,{className:"text-red-600 max-w-xs truncate",children:a.old||"(vacío)"}),(0,s.jsx)(v.TableCell,{className:"text-green-600 max-w-xs truncate",children:a.new||"(vacío)"})]},e))})]})]})})]},a.id)})}),A&&(0,s.jsx)("div",{className:"text-center mt-4",children:(0,s.jsx)(h.Button,{variant:"outline",onClick:()=>E(!1),disabled:g,children:g?"Cargando...":"Cargar más"})})]})]})}e.s(["ProductChangelog",()=>f],622998)}]);