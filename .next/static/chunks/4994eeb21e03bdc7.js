(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,10708,e=>{"use strict";var t=e.i(843476),a=e.i(271645),r=e.i(248425),s=a.forwardRef((e,a)=>(0,t.jsx)(r.Primitive.label,{...e,ref:a,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));s.displayName="Label";var l=e.i(647163);function i({className:e,...a}){return(0,t.jsx)(s,{"data-slot":"label",className:(0,l.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...a})}e.s(["Label",()=>i],10708)},184762,e=>{"use strict";var t=e.i(843476),a=e.i(647163);function r({className:e,...r}){return(0,t.jsx)("textarea",{"data-slot":"textarea",className:(0,a.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...r})}e.s(["Textarea",()=>r])},947627,e=>{"use strict";var t=e.i(843476),a=e.i(647163);function r({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,t.jsx)("table",{"data-slot":"table",className:(0,a.cn)("w-full caption-bottom text-sm",e),...r})})}function s({className:e,...r}){return(0,t.jsx)("thead",{"data-slot":"table-header",className:(0,a.cn)("[&_tr]:border-b",e),...r})}function l({className:e,...r}){return(0,t.jsx)("tbody",{"data-slot":"table-body",className:(0,a.cn)("[&_tr:last-child]:border-0",e),...r})}function i({className:e,...r}){return(0,t.jsx)("tfoot",{"data-slot":"table-footer",className:(0,a.cn)("bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",e),...r})}function n({className:e,...r}){return(0,t.jsx)("tr",{"data-slot":"table-row",className:(0,a.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...r})}function d({className:e,...r}){return(0,t.jsx)("th",{"data-slot":"table-head",className:(0,a.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}function o({className:e,...r}){return(0,t.jsx)("td",{"data-slot":"table-cell",className:(0,a.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}function c({className:e,...r}){return(0,t.jsx)("caption",{"data-slot":"table-caption",className:(0,a.cn)("text-muted-foreground mt-4 text-sm",e),...r})}e.s(["Table",()=>r,"TableBody",()=>l,"TableCaption",()=>c,"TableCell",()=>o,"TableFooter",()=>i,"TableHead",()=>d,"TableHeader",()=>s,"TableRow",()=>n])},970065,e=>{"use strict";var t=e.i(843476),a=e.i(647163);function r({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...r})}function s({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...r})}function l({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...r})}function i({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",e),...r})}function n({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...r})}function d({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"card-footer",className:(0,a.cn)("flex items-center px-6 [.border-t]:pt-6",e),...r})}e.s(["Card",()=>r,"CardContent",()=>n,"CardDescription",()=>i,"CardFooter",()=>d,"CardHeader",()=>s,"CardTitle",()=>l])},470152,e=>{"use strict";function t(e,[t,a]){return Math.min(a,Math.max(t,e))}e.s(["clamp",()=>t])},727612,e=>{"use strict";let t=(0,e.i(475254).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>t],727612)},356909,e=>{"use strict";let t=(0,e.i(475254).default)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>t],356909)},710369,e=>{"use strict";var t=e.i(843476),a=e.i(271645),r=e.i(618566),s=e.i(920755),l=e.i(167881),i=e.i(23750),n=e.i(10708),d=e.i(62870),o=e.i(184762),c=e.i(970065),u=e.i(947627),p=e.i(727612),x=e.i(356909),h=e.i(657688);function m({distributorId:e,companies:m,products:b,userId:j}){let f=(0,r.useRouter)(),[g,v]=(0,a.useState)(""),[C,_]=(0,a.useState)([]),[y,N]=(0,a.useState)(""),[T,w]=(0,a.useState)(""),[S,k]=(0,a.useState)(!1),H=(e,t)=>{t<1?I(e):_(a=>a.map(a=>a.product_id===e?{...a,quantity:t,subtotal:a.unit_price*t}:a))},I=e=>{_(t=>t.filter(t=>t.product_id!==e))},L=C.reduce((e,t)=>e+t.subtotal,0),M=.19*L,D=L+M,P=async()=>{if(!g)return void alert("Por favor selecciona un cliente");if(0===C.length)return void alert("Por favor agrega al menos un producto");k(!0);let t=(0,s.createClient)();try{let a=`ORD-${Date.now()}-${Math.random().toString(36).substr(2,9).toUpperCase()}`,{data:r,error:s}=await t.from("orders").insert({order_number:a,user_id:j,distributor_id:e,company_id:g,emisor:"Alumar SAS",fecha_pedido:new Date().toISOString().split("T")[0],status:"pending_approval",payment_status:"pending",subtotal:L,discount_amount:0,tax_amount:M,iva_porcentaje:19,shipping_cost:0,total:D,shipping_address:T||null,notes:y||null}).select().single();if(s)throw s;let l=C.map(e=>({order_id:r.id,product_id:e.product_id,product_code:e.product.pdt_codigo,product_name:e.product.nombre_comercial||e.product.pdt_descripcion,quantity:e.quantity,unit_price:e.unit_price,discount_percentage:0,discount_amount:0,subtotal:e.subtotal})),{error:i}=await t.from("order_items").insert(l);if(i)throw i;alert("Orden creada exitosamente"),f.push("/distributor/orders")}catch(e){console.error("[v0] Error creating order:",e),alert("Error al crear la orden")}finally{k(!1)}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(c.Card,{children:[(0,t.jsx)(c.CardHeader,{children:(0,t.jsx)(c.CardTitle,{children:"Información del Cliente"})}),(0,t.jsxs)(c.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"company",children:"Cliente *"}),(0,t.jsxs)(d.Select,{value:g,onValueChange:v,children:[(0,t.jsx)(d.SelectTrigger,{children:(0,t.jsx)(d.SelectValue,{placeholder:"Selecciona un cliente"})}),(0,t.jsx)(d.SelectContent,{children:m.map(e=>(0,t.jsxs)(d.SelectItem,{value:e.id,children:[e.razon_social," - NIT: ",e.nit]},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"address",children:"Dirección de Envío"}),(0,t.jsx)(i.Input,{id:"address",value:T,onChange:e=>w(e.target.value),placeholder:"Ingresa la dirección de envío"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"notes",children:"Notas e Instrucciones Especiales"}),(0,t.jsx)(o.Textarea,{id:"notes",value:y,onChange:e=>N(e.target.value),placeholder:"Comentarios adicionales sobre el pedido...",rows:3})]})]})]}),(0,t.jsxs)(c.Card,{children:[(0,t.jsx)(c.CardHeader,{children:(0,t.jsx)(c.CardTitle,{children:"Productos"})}),(0,t.jsxs)(c.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{children:"Agregar Producto"}),(0,t.jsxs)(d.Select,{onValueChange:e=>{let t=b.find(t=>t.id===e);if(!t||!t.precio)return;let a=C.find(t=>t.product_id===e);a?H(e,a.quantity+1):_([...C,{product_id:e,product:t,quantity:1,unit_price:t.precio,subtotal:t.precio}])},children:[(0,t.jsx)(d.SelectTrigger,{children:(0,t.jsx)(d.SelectValue,{placeholder:"Selecciona un producto"})}),(0,t.jsx)(d.SelectContent,{children:b.map(e=>(0,t.jsxs)(d.SelectItem,{value:e.id,children:[e.pdt_codigo," - ",e.nombre_comercial||e.pdt_descripcion," - $",e.precio?.toLocaleString()]},e.id))})]})]}),C.length>0&&(0,t.jsx)("div",{className:"rounded-md border",children:(0,t.jsxs)(u.Table,{children:[(0,t.jsx)(u.TableHeader,{children:(0,t.jsxs)(u.TableRow,{children:[(0,t.jsx)(u.TableHead,{className:"w-[80px]",children:"Imagen"}),(0,t.jsx)(u.TableHead,{children:"SKU"}),(0,t.jsx)(u.TableHead,{children:"Descripción"}),(0,t.jsx)(u.TableHead,{children:"Precio Unit."}),(0,t.jsx)(u.TableHead,{children:"Cantidad"}),(0,t.jsx)(u.TableHead,{children:"Subtotal"}),(0,t.jsx)(u.TableHead,{className:"w-[80px]"})]})}),(0,t.jsx)(u.TableBody,{children:C.map(e=>(0,t.jsxs)(u.TableRow,{children:[(0,t.jsx)(u.TableCell,{children:(0,t.jsx)("div",{className:"relative h-12 w-12 overflow-hidden rounded-md border",children:e.product.imagen_principal_url?(0,t.jsx)(h.default,{src:e.product.imagen_principal_url||"/placeholder.svg",alt:e.product.nombre_comercial||e.product.pdt_descripcion,fill:!0,className:"object-cover"}):(0,t.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-muted text-xs",children:"Sin imagen"})})}),(0,t.jsx)(u.TableCell,{className:"font-mono",children:e.product.pdt_codigo}),(0,t.jsx)(u.TableCell,{children:e.product.nombre_comercial||e.product.pdt_descripcion}),(0,t.jsxs)(u.TableCell,{children:["$",e.unit_price.toLocaleString()]}),(0,t.jsx)(u.TableCell,{children:(0,t.jsx)(i.Input,{type:"number",min:"1",value:e.quantity,onChange:t=>H(e.product_id,Number.parseInt(t.target.value)),className:"w-20"})}),(0,t.jsxs)(u.TableCell,{className:"font-medium",children:["$",e.subtotal.toLocaleString()]}),(0,t.jsx)(u.TableCell,{children:(0,t.jsx)(l.Button,{variant:"ghost",size:"icon",onClick:()=>I(e.product_id),children:(0,t.jsx)(p.Trash2,{className:"h-4 w-4 text-destructive"})})})]},e.product_id))})]})})]})]}),C.length>0&&(0,t.jsxs)(c.Card,{children:[(0,t.jsx)(c.CardHeader,{children:(0,t.jsx)(c.CardTitle,{children:"Resumen de la Orden"})}),(0,t.jsx)(c.CardContent,{children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Subtotal:"}),(0,t.jsxs)("span",{className:"font-medium",children:["$",L.toLocaleString()]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{children:["IVA (",19,"%):"]}),(0,t.jsxs)("span",{className:"font-medium",children:["$",M.toLocaleString()]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[(0,t.jsx)("span",{children:"Total:"}),(0,t.jsxs)("span",{children:["$",D.toLocaleString()]})]})]})})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,t.jsx)(l.Button,{variant:"outline",onClick:()=>f.back(),disabled:S,children:"Cancelar"}),(0,t.jsxs)(l.Button,{onClick:P,disabled:S||0===C.length,children:[(0,t.jsx)(x.Save,{className:"mr-2 h-4 w-4"}),S?"Creando...":"Crear Orden"]})]})]})}e.s(["default",()=>m])}]);