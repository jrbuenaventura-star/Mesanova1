(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,70065,e=>{"use strict";var a=e.i(43476),t=e.i(47163);function r({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card",className:(0,t.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...r})}function s({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,t.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...r})}function l({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,t.cn)("leading-none font-semibold",e),...r})}function d({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,t.cn)("text-muted-foreground text-sm",e),...r})}function n({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,t.cn)("px-6",e),...r})}function i({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-footer",className:(0,t.cn)("flex items-center px-6 [.border-t]:pt-6",e),...r})}e.s(["Card",()=>r,"CardContent",()=>n,"CardDescription",()=>d,"CardFooter",()=>i,"CardHeader",()=>s,"CardTitle",()=>l])},47627,e=>{"use strict";var a=e.i(43476),t=e.i(47163);function r({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,t.cn)("w-full caption-bottom text-sm",e),...r})})}function s({className:e,...r}){return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,t.cn)("[&_tr]:border-b",e),...r})}function l({className:e,...r}){return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,t.cn)("[&_tr:last-child]:border-0",e),...r})}function d({className:e,...r}){return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,t.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...r})}function n({className:e,...r}){return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,t.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}function i({className:e,...r}){return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,t.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}e.s(["Table",()=>r,"TableBody",()=>l,"TableCell",()=>i,"TableHead",()=>n,"TableHeader",()=>s,"TableRow",()=>d])},27612,e=>{"use strict";let a=(0,e.i(75254).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>a],27612)},56909,e=>{"use strict";let a=(0,e.i(75254).default)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>a],56909)},10369,e=>{"use strict";var a=e.i(43476),t=e.i(71645),r=e.i(18566),s=e.i(20755),l=e.i(67881),d=e.i(23750),n=e.i(10708),i=e.i(62870),c=e.i(84762),o=e.i(70065),u=e.i(47627),h=e.i(27612),p=e.i(56909),x=e.i(57688);function m({distributorId:e,companies:m,products:j,userId:b}){let f=(0,r.useRouter)(),[g,v]=(0,t.useState)(""),[_,C]=(0,t.useState)([]),[y,T]=(0,t.useState)(""),[N,S]=(0,t.useState)(""),[w,k]=(0,t.useState)(!1),H=(e,a)=>{a<1?I(e):C(t=>t.map(t=>t.product_id===e?{...t,quantity:a,subtotal:t.unit_price*a}:t))},I=e=>{C(a=>a.filter(a=>a.product_id!==e))},L=_.reduce((e,a)=>e+a.subtotal,0),V=.19*L,R=L+V,$=async()=>{if(!g)return void alert("Por favor selecciona un cliente");if(0===_.length)return void alert("Por favor agrega al menos un producto");k(!0);let a=(0,s.createClient)();try{let t=`ORD-${Date.now()}-${Math.random().toString(36).substr(2,9).toUpperCase()}`,{data:r,error:s}=await a.from("orders").insert({order_number:t,user_id:b,distributor_id:e,company_id:g,emisor:"Alumar SAS",fecha_pedido:new Date().toISOString().split("T")[0],status:"pending_approval",payment_status:"pending",subtotal:L,discount_amount:0,tax_amount:V,iva_porcentaje:19,shipping_cost:0,total:R,shipping_address:N||null,notes:y||null}).select().single();if(s)throw s;let l=_.map(e=>({order_id:r.id,product_id:e.product_id,product_code:e.product.pdt_codigo,product_name:e.product.nombre_comercial||e.product.pdt_descripcion,quantity:e.quantity,unit_price:e.unit_price,discount_percentage:0,discount_amount:0,subtotal:e.subtotal})),{error:d}=await a.from("order_items").insert(l);if(d)throw d;alert("Orden creada exitosamente"),f.push("/distributor/orders")}catch(e){console.error("[v0] Error creating order:",e),alert("Error al crear la orden")}finally{k(!1)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(o.Card,{children:[(0,a.jsx)(o.CardHeader,{children:(0,a.jsx)(o.CardTitle,{children:"Información del Cliente"})}),(0,a.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{htmlFor:"company",children:"Cliente *"}),(0,a.jsxs)(i.Select,{value:g,onValueChange:v,children:[(0,a.jsx)(i.SelectTrigger,{children:(0,a.jsx)(i.SelectValue,{placeholder:"Selecciona un cliente"})}),(0,a.jsx)(i.SelectContent,{children:m.map(e=>(0,a.jsxs)(i.SelectItem,{value:e.id,children:[e.razon_social," - NIT: ",e.nit]},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{htmlFor:"address",children:"Dirección de Envío"}),(0,a.jsx)(d.Input,{id:"address",value:N,onChange:e=>S(e.target.value),placeholder:"Ingresa la dirección de envío"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{htmlFor:"notes",children:"Notas e Instrucciones Especiales"}),(0,a.jsx)(c.Textarea,{id:"notes",value:y,onChange:e=>T(e.target.value),placeholder:"Comentarios adicionales sobre el pedido...",rows:3})]})]})]}),(0,a.jsxs)(o.Card,{children:[(0,a.jsx)(o.CardHeader,{children:(0,a.jsx)(o.CardTitle,{children:"Productos"})}),(0,a.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.Label,{children:"Agregar Producto"}),(0,a.jsxs)(i.Select,{onValueChange:e=>{let a=j.find(a=>a.id===e);if(!a||!a.precio)return;let t=_.find(a=>a.product_id===e);t?H(e,t.quantity+1):C([..._,{product_id:e,product:a,quantity:1,unit_price:a.precio,subtotal:a.precio}])},children:[(0,a.jsx)(i.SelectTrigger,{children:(0,a.jsx)(i.SelectValue,{placeholder:"Selecciona un producto"})}),(0,a.jsx)(i.SelectContent,{children:j.map(e=>(0,a.jsxs)(i.SelectItem,{value:e.id,children:[e.pdt_codigo," - ",e.nombre_comercial||e.pdt_descripcion," - $",e.precio?.toLocaleString()]},e.id))})]})]}),_.length>0&&(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(u.Table,{children:[(0,a.jsx)(u.TableHeader,{children:(0,a.jsxs)(u.TableRow,{children:[(0,a.jsx)(u.TableHead,{className:"w-[80px]",children:"Imagen"}),(0,a.jsx)(u.TableHead,{children:"SKU"}),(0,a.jsx)(u.TableHead,{children:"Descripción"}),(0,a.jsx)(u.TableHead,{children:"Precio Unit."}),(0,a.jsx)(u.TableHead,{children:"Cantidad"}),(0,a.jsx)(u.TableHead,{children:"Subtotal"}),(0,a.jsx)(u.TableHead,{className:"w-[80px]"})]})}),(0,a.jsx)(u.TableBody,{children:_.map(e=>(0,a.jsxs)(u.TableRow,{children:[(0,a.jsx)(u.TableCell,{children:(0,a.jsx)("div",{className:"relative h-12 w-12 overflow-hidden rounded-md border",children:e.product.imagen_principal_url?(0,a.jsx)(x.default,{src:e.product.imagen_principal_url||"/placeholder.svg",alt:e.product.nombre_comercial||e.product.pdt_descripcion,fill:!0,className:"object-cover"}):(0,a.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-muted text-xs",children:"Sin imagen"})})}),(0,a.jsx)(u.TableCell,{className:"font-mono",children:e.product.pdt_codigo}),(0,a.jsx)(u.TableCell,{children:e.product.nombre_comercial||e.product.pdt_descripcion}),(0,a.jsxs)(u.TableCell,{children:["$",e.unit_price.toLocaleString()]}),(0,a.jsx)(u.TableCell,{children:(0,a.jsx)(d.Input,{type:"number",min:"1",value:e.quantity,onChange:a=>H(e.product_id,Number.parseInt(a.target.value)),className:"w-20"})}),(0,a.jsxs)(u.TableCell,{className:"font-medium",children:["$",e.subtotal.toLocaleString()]}),(0,a.jsx)(u.TableCell,{children:(0,a.jsx)(l.Button,{variant:"ghost",size:"icon",onClick:()=>I(e.product_id),children:(0,a.jsx)(h.Trash2,{className:"h-4 w-4 text-destructive"})})})]},e.product_id))})]})})]})]}),_.length>0&&(0,a.jsxs)(o.Card,{children:[(0,a.jsx)(o.CardHeader,{children:(0,a.jsx)(o.CardTitle,{children:"Resumen de la Orden"})}),(0,a.jsx)(o.CardContent,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Subtotal:"}),(0,a.jsxs)("span",{className:"font-medium",children:["$",L.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:["IVA (",19,"%):"]}),(0,a.jsxs)("span",{className:"font-medium",children:["$",V.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[(0,a.jsx)("span",{children:"Total:"}),(0,a.jsxs)("span",{children:["$",R.toLocaleString()]})]})]})})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)(l.Button,{variant:"outline",onClick:()=>f.back(),disabled:w,children:"Cancelar"}),(0,a.jsxs)(l.Button,{onClick:$,disabled:w||0===_.length,children:[(0,a.jsx)(p.Save,{className:"mr-2 h-4 w-4"}),w?"Creando...":"Crear Orden"]})]})]})}e.s(["default",()=>m])}]);