(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,184762,e=>{"use strict";var a=e.i(843476),t=e.i(647163);function r({className:e,...r}){return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,t.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...r})}e.s(["Textarea",()=>r])},947627,e=>{"use strict";var a=e.i(843476),t=e.i(647163);function r({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,t.cn)("w-full caption-bottom text-sm",e),...r})})}function s({className:e,...r}){return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,t.cn)("[&_tr]:border-b",e),...r})}function i({className:e,...r}){return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,t.cn)("[&_tr:last-child]:border-0",e),...r})}function l({className:e,...r}){return(0,a.jsx)("tfoot",{"data-slot":"table-footer",className:(0,t.cn)("bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",e),...r})}function n({className:e,...r}){return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,t.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...r})}function d({className:e,...r}){return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,t.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}function c({className:e,...r}){return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,t.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}function o({className:e,...r}){return(0,a.jsx)("caption",{"data-slot":"table-caption",className:(0,t.cn)("text-muted-foreground mt-4 text-sm",e),...r})}e.s(["Table",()=>r,"TableBody",()=>i,"TableCaption",()=>o,"TableCell",()=>c,"TableFooter",()=>l,"TableHead",()=>d,"TableHeader",()=>s,"TableRow",()=>n])},970065,e=>{"use strict";var a=e.i(843476),t=e.i(647163);function r({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card",className:(0,t.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...r})}function s({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,t.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...r})}function i({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,t.cn)("leading-none font-semibold",e),...r})}function l({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,t.cn)("text-muted-foreground text-sm",e),...r})}function n({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,t.cn)("px-6",e),...r})}function d({className:e,...r}){return(0,a.jsx)("div",{"data-slot":"card-footer",className:(0,t.cn)("flex items-center px-6 [.border-t]:pt-6",e),...r})}e.s(["Card",()=>r,"CardContent",()=>n,"CardDescription",()=>l,"CardFooter",()=>d,"CardHeader",()=>s,"CardTitle",()=>i])},994179,e=>{"use strict";var a=e.i(843476),t=e.i(991918),r=e.i(225913),s=e.i(647163);let i=(0,r.cva)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function l({className:e,variant:r,asChild:l=!1,...n}){let d=l?t.Slot:"span";return(0,a.jsx)(d,{"data-slot":"badge",className:(0,s.cn)(i({variant:r}),e),...n})}e.s(["Badge",()=>l])},269638,e=>{"use strict";let a=(0,e.i(475254).default)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>a],269638)},286536,e=>{"use strict";let a=(0,e.i(475254).default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>a],286536)},212426,e=>{"use strict";let a=(0,e.i(475254).default)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);e.s(["DollarSign",()=>a],212426)},781947,e=>{"use strict";var a=e.i(843476),t=e.i(225913),r=e.i(647163);let s=(0,t.cva)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function i({className:e,variant:t,...i}){return(0,a.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,r.cn)(s({variant:t}),e),...i})}function l({className:e,...t}){return(0,a.jsx)("div",{"data-slot":"alert-title",className:(0,r.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",e),...t})}function n({className:e,...t}){return(0,a.jsx)("div",{"data-slot":"alert-description",className:(0,r.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",e),...t})}e.s(["Alert",()=>i,"AlertDescription",()=>n,"AlertTitle",()=>l])},373884,e=>{"use strict";let a=(0,e.i(475254).default)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>a],373884)},87316,e=>{"use strict";let a=(0,e.i(475254).default)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>a],87316)},383553,e=>{"use strict";var a=e.i(843476),t=e.i(271645),r=e.i(618566),s=e.i(920755),i=e.i(970065),l=e.i(167881),n=e.i(994179),d=e.i(184762),c=e.i(781947),o=e.i(947627),x=e.i(630374),u=e.i(269638),m=e.i(373884),h=e.i(286536),p=e.i(607486),j=e.i(284614),b=e.i(87316),g=e.i(212426),f=e.i(531278);function v({orders:e,userId:v}){let N=(0,r.useRouter)(),C=(0,s.createClient)(),[y,T]=(0,t.useState)(null),[w,k]=(0,t.useState)(!1),[D,_]=(0,t.useState)(null),[H,A]=(0,t.useState)(""),[z,S]=(0,t.useState)(!1),[B,F]=(0,t.useState)(null),O=(e,a)=>{T(e),_(a),k(!0),A(""),F(null)},R=async()=>{if(y&&D){if("reject"===D&&!H.trim())return void F("Debes proporcionar una razón para rechazar la orden");S(!0),F(null);try{let e={approved_by:v,approved_at:new Date().toISOString()};"approve"===D?e.status="aprobada":(e.status="cancelada",e.rejected_reason=H,e.rejected_at=new Date().toISOString());let{error:a}=await C.from("orders").update(e).eq("id",y.id);if(a)throw a;k(!1),T(null),N.refresh()}catch(e){console.error("Error processing approval:",e),F(e instanceof Error?e.message:"Error al procesar la aprobación")}finally{S(!1)}}},P=e.filter(e=>"por_aprobar"===e.status);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(i.Card,{children:[(0,a.jsxs)(i.CardHeader,{children:[(0,a.jsx)(i.CardTitle,{children:"Órdenes Pendientes de Aprobación"}),(0,a.jsx)(i.CardDescription,{children:"Revisa y aprueba las órdenes creadas por aliados"})]}),(0,a.jsx)(i.CardContent,{children:0===P.length?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(u.CheckCircle,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{className:"text-lg font-medium",children:"No hay órdenes pendientes de aprobación"})]}):(0,a.jsxs)(o.Table,{children:[(0,a.jsx)(o.TableHeader,{children:(0,a.jsxs)(o.TableRow,{children:[(0,a.jsx)(o.TableHead,{children:"Orden"}),(0,a.jsx)(o.TableHead,{children:"Aliado"}),(0,a.jsx)(o.TableHead,{children:"Distribuidor"}),(0,a.jsx)(o.TableHead,{children:"Fecha"}),(0,a.jsx)(o.TableHead,{children:"Total"}),(0,a.jsx)(o.TableHead,{children:"Descuento"}),(0,a.jsx)(o.TableHead,{className:"text-right",children:"Acciones"})]})}),(0,a.jsx)(o.TableBody,{children:P.map(e=>(0,a.jsxs)(o.TableRow,{children:[(0,a.jsx)(o.TableCell,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.id.slice(0,8)}),(0,a.jsx)(n.Badge,{variant:"outline",className:"mt-1",children:"Por Aprobar"})]})}),(0,a.jsx)(o.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(j.User,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm",children:e.aliado?.company_name||"N/A"})]})}),(0,a.jsx)(o.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.Building2,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm",children:e.distributor?.company_name||e.customer_name})]})}),(0,a.jsx)(o.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(b.Calendar,{className:"h-3 w-3 text-muted-foreground"}),e.created_at?new Date(e.created_at).toLocaleDateString():"N/A"]})}),(0,a.jsx)(o.TableCell,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(g.DollarSign,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("span",{className:"font-bold",children:["$",e.total.toFixed(2)]})]})}),(0,a.jsx)(o.TableCell,{children:e.discount_percentage?(0,a.jsxs)(n.Badge,{variant:"secondary",children:[e.discount_percentage,"%"]}):(0,a.jsx)("span",{className:"text-muted-foreground text-sm",children:"N/A"})}),(0,a.jsx)(o.TableCell,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,a.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>T(e),children:[(0,a.jsx)(h.Eye,{className:"h-4 w-4 mr-1"}),"Ver"]}),(0,a.jsxs)(l.Button,{variant:"default",size:"sm",onClick:()=>O(e,"approve"),children:[(0,a.jsx)(u.CheckCircle,{className:"h-4 w-4 mr-1"}),"Aprobar"]}),(0,a.jsxs)(l.Button,{variant:"destructive",size:"sm",onClick:()=>O(e,"reject"),children:[(0,a.jsx)(m.XCircle,{className:"h-4 w-4 mr-1"}),"Rechazar"]})]})})]},e.id))})]})})]}),(0,a.jsx)(x.Dialog,{open:w,onOpenChange:k,children:(0,a.jsxs)(x.DialogContent,{children:[(0,a.jsxs)(x.DialogHeader,{children:[(0,a.jsx)(x.DialogTitle,{children:"approve"===D?"Aprobar Orden":"Rechazar Orden"}),(0,a.jsx)(x.DialogDescription,{children:"approve"===D?"¿Estás seguro de que deseas aprobar esta orden?":"Proporciona una razón para rechazar esta orden"})]}),B&&(0,a.jsx)(c.Alert,{variant:"destructive",children:(0,a.jsx)(c.AlertDescription,{children:B})}),y&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Orden"}),(0,a.jsx)("p",{className:"font-medium",children:y.id.slice(0,8)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Total"}),(0,a.jsxs)("p",{className:"font-bold",children:["$",y.total.toFixed(2)]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Aliado"}),(0,a.jsx)("p",{className:"font-medium",children:y.aliado?.company_name||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Distribuidor"}),(0,a.jsx)("p",{className:"font-medium",children:y.distributor?.company_name||y.customer_name})]})]}),"reject"===D&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Razón del rechazo *"}),(0,a.jsx)(d.Textarea,{placeholder:"Explica por qué se rechaza esta orden...",value:H,onChange:e=>A(e.target.value),rows:4,className:"mt-2"})]})]}),(0,a.jsxs)(x.DialogFooter,{children:[(0,a.jsx)(l.Button,{variant:"outline",onClick:()=>k(!1),disabled:z,children:"Cancelar"}),(0,a.jsx)(l.Button,{variant:"approve"===D?"default":"destructive",onClick:R,disabled:z,children:z?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Procesando..."]}):"approve"===D?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.CheckCircle,{className:"mr-2 h-4 w-4"}),"Aprobar"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(m.XCircle,{className:"mr-2 h-4 w-4"}),"Rechazar"]})})]})]})}),y&&!w&&(0,a.jsx)(x.Dialog,{open:!!y,onOpenChange:()=>T(null),children:(0,a.jsxs)(x.DialogContent,{className:"max-w-3xl",children:[(0,a.jsxs)(x.DialogHeader,{children:[(0,a.jsx)(x.DialogTitle,{children:"Detalles de la Orden"}),(0,a.jsxs)(x.DialogDescription,{children:["Orden #",y.id.slice(0,8)]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm",children:"Información General"})}),(0,a.jsxs)(i.CardContent,{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Aliado"}),(0,a.jsx)("p",{className:"font-medium",children:y.aliado?.company_name||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Distribuidor"}),(0,a.jsx)("p",{className:"font-medium",children:y.distributor?.company_name||y.customer_name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Fecha"}),(0,a.jsx)("p",{className:"font-medium",children:y.created_at?new Date(y.created_at).toLocaleDateString():"N/A"})]})]})]}),(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm",children:"Totales"})}),(0,a.jsxs)(i.CardContent,{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Subtotal"}),(0,a.jsxs)("span",{className:"font-medium",children:["$",y.subtotal.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Descuento"}),(0,a.jsxs)("span",{className:"font-medium",children:[y.discount_percentage,"%"]})]}),(0,a.jsxs)("div",{className:"flex justify-between font-bold",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsxs)("span",{children:["$",y.total.toFixed(2)]})]})]})]})]}),y.notes&&(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsx)(i.CardTitle,{className:"text-sm",children:"Notas"})}),(0,a.jsx)(i.CardContent,{children:(0,a.jsx)("p",{className:"text-sm",children:y.notes})})]}),y.items&&y.items.length>0&&(0,a.jsxs)(i.Card,{children:[(0,a.jsx)(i.CardHeader,{className:"pb-3",children:(0,a.jsxs)(i.CardTitle,{className:"text-sm",children:["Productos (",y.items.length,")"]})}),(0,a.jsx)(i.CardContent,{children:(0,a.jsxs)(o.Table,{children:[(0,a.jsx)(o.TableHeader,{children:(0,a.jsxs)(o.TableRow,{children:[(0,a.jsx)(o.TableHead,{children:"Producto"}),(0,a.jsx)(o.TableHead,{className:"text-right",children:"Cantidad"}),(0,a.jsx)(o.TableHead,{className:"text-right",children:"Precio Unit."}),(0,a.jsx)(o.TableHead,{className:"text-right",children:"Subtotal"})]})}),(0,a.jsx)(o.TableBody,{children:y.items.map(e=>(0,a.jsxs)(o.TableRow,{children:[(0,a.jsx)(o.TableCell,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:e.product_name||e.product?.nombre_comercial}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:e.product_code||e.product?.pdt_codigo})]})}),(0,a.jsx)(o.TableCell,{className:"text-right",children:e.quantity}),(0,a.jsxs)(o.TableCell,{className:"text-right",children:["$",e.unit_price.toFixed(2)]}),(0,a.jsxs)(o.TableCell,{className:"text-right font-medium",children:["$",e.subtotal.toFixed(2)]})]},e.id))})]})})]})]}),(0,a.jsx)(x.DialogFooter,{children:(0,a.jsx)(l.Button,{variant:"outline",onClick:()=>T(null),children:"Cerrar"})})]})})]})}e.s(["OrdersApproval",()=>v])}]);