(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,10708,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(248425),i=a.forwardRef((e,a)=>(0,t.jsx)(s.Primitive.label,{...e,ref:a,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var r=e.i(647163);function o({className:e,...a}){return(0,t.jsx)(i,{"data-slot":"label",className:(0,r.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...a})}e.s(["Label",()=>o],10708)},470152,e=>{"use strict";function t(e,[t,a]){return Math.min(a,Math.max(t,e))}e.s(["clamp",()=>t])},120682,e=>{"use strict";var t=e.i(271645);let a=0,s=new Map,i=e=>{if(s.has(e))return;let t=setTimeout(()=>{s.delete(e),n({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,t)},r=[],o={toasts:[]};function n(e){o=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?i(a):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(o,e),r.forEach(e=>{e(o)})}function c({...e}){let t=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>n({type:"DISMISS_TOAST",toastId:t});return n({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>n({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function l(){let[e,a]=t.useState(o);return t.useEffect(()=>(r.push(a),()=>{let e=r.indexOf(a);e>-1&&r.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>n({type:"DISMISS_TOAST",toastId:e})}}e.s(["toast",()=>c,"useToast",()=>l])},569074,e=>{"use strict";let t=(0,e.i(475254).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>t],569074)},178583,e=>{"use strict";let t=(0,e.i(475254).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>t],178583)},511066,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(618566),i=e.i(920755),r=e.i(167881),o=e.i(23750),n=e.i(10708),c=e.i(62870),l=e.i(120682),d=e.i(531278);let p=["Tienda de hogar","Restaurante","Hotel","Catering","Mayorista","Minorista","Institucional","Otro"];function u({distributor:e,userProfile:u}){let m=(0,s.useRouter)(),{toast:h}=(0,l.useToast)(),_=(0,i.createClient)(),[y,f]=(0,a.useState)(!1),[x,v]=(0,a.useState)({company_name:e?.company_name||"",company_rif:e?.company_rif||"",business_type:e?.business_type||"",contact_name:e?.contact_name||u?.full_name||"",contact_email:e?.contact_email||"",contact_phone:e?.contact_phone||u?.phone||"",contact_position:e?.contact_position||"",address:e?.address||"",city:e?.city||"",state:e?.state||""}),g=(e,t)=>{v(a=>({...a,[e]:t}))},b=async t=>{t.preventDefault(),f(!0);try{if(e?.id){let{error:t}=await _.from("distributors").update({company_name:x.company_name,company_rif:x.company_rif,business_type:x.business_type,contact_name:x.contact_name,contact_email:x.contact_email,contact_phone:x.contact_phone,contact_position:x.contact_position,address:x.address,city:x.city,state:x.state}).eq("id",e.id);if(t)throw t}else{let{data:{user:e}}=await _.auth.getUser();if(!e)throw Error("No autenticado");let{error:t}=await _.from("distributors").insert({user_id:e.id,company_name:x.company_name,company_rif:x.company_rif,business_type:x.business_type,contact_name:x.contact_name,contact_email:x.contact_email,contact_phone:x.contact_phone,contact_position:x.contact_position,address:x.address,city:x.city,state:x.state,requires_approval:!0});if(t)throw t}h({title:"Perfil actualizado",description:"Los cambios se han guardado correctamente"}),m.refresh()}catch(e){h({title:"Error",description:e.message||"No se pudo guardar el perfil",variant:"destructive"})}finally{f(!1)}};return(0,t.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"company_name",children:"Nombre de la Empresa *"}),(0,t.jsx)(o.Input,{id:"company_name",value:x.company_name,onChange:e=>g("company_name",e.target.value),placeholder:"Mi Empresa S.A.S.",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"company_rif",children:"NIT / RIF"}),(0,t.jsx)(o.Input,{id:"company_rif",value:x.company_rif,onChange:e=>g("company_rif",e.target.value),placeholder:"900.123.456-7"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"business_type",children:"Tipo de Negocio *"}),(0,t.jsxs)(c.Select,{value:x.business_type,onValueChange:e=>g("business_type",e),children:[(0,t.jsx)(c.SelectTrigger,{children:(0,t.jsx)(c.SelectValue,{placeholder:"Selecciona tipo"})}),(0,t.jsx)(c.SelectContent,{children:p.map(e=>(0,t.jsx)(c.SelectItem,{value:e,children:e},e))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"contact_name",children:"Nombre del Contacto *"}),(0,t.jsx)(o.Input,{id:"contact_name",value:x.contact_name,onChange:e=>g("contact_name",e.target.value),placeholder:"Juan Pérez",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"contact_email",children:"Email de Contacto"}),(0,t.jsx)(o.Input,{id:"contact_email",type:"email",value:x.contact_email,onChange:e=>g("contact_email",e.target.value),placeholder:"contacto@empresa.com"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"contact_phone",children:"Teléfono de Contacto"}),(0,t.jsx)(o.Input,{id:"contact_phone",value:x.contact_phone,onChange:e=>g("contact_phone",e.target.value),placeholder:"+57 300 123 4567"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"contact_position",children:"Cargo"}),(0,t.jsx)(o.Input,{id:"contact_position",value:x.contact_position,onChange:e=>g("contact_position",e.target.value),placeholder:"Gerente de Compras"})]}),(0,t.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,t.jsx)(n.Label,{htmlFor:"address",children:"Dirección"}),(0,t.jsx)(o.Input,{id:"address",value:x.address,onChange:e=>g("address",e.target.value),placeholder:"Calle 123 # 45-67"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"city",children:"Ciudad"}),(0,t.jsx)(o.Input,{id:"city",value:x.city,onChange:e=>g("city",e.target.value),placeholder:"Bogotá"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(n.Label,{htmlFor:"state",children:"Departamento"}),(0,t.jsx)(o.Input,{id:"state",value:x.state,onChange:e=>g("state",e.target.value),placeholder:"Cundinamarca"})]})]}),(0,t.jsxs)(r.Button,{type:"submit",disabled:y,className:"w-full",children:[y&&(0,t.jsx)(d.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),e?"Guardar Cambios":"Crear Perfil"]})]})}e.s(["DistributorProfileForm",()=>u])},3377,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(618566),i=e.i(920755),r=e.i(167881),o=e.i(120682),n=e.i(569074),c=e.i(531278),l=e.i(178583);function d({distributorId:e,documentType:d,onUploadComplete:p}){let u=(0,s.useRouter)(),{toast:m}=(0,o.useToast)(),h=(0,i.createClient)(),[_,y]=(0,a.useState)(!1),[f,x]=(0,a.useState)(null),v=(0,a.useCallback)(e=>{let t=e.target.files?.[0];if(t){if(!["application/pdf","image/jpeg","image/png","image/jpg"].includes(t.type))return void m({title:"Tipo de archivo no permitido",description:"Solo se permiten archivos PDF, JPG o PNG",variant:"destructive"});if(t.size>0xa00000)return void m({title:"Archivo muy grande",description:"El archivo no puede ser mayor a 10MB",variant:"destructive"});x(t)}},[m]),g=async()=>{if(!f||!e)return void m({title:"Error",description:e?"Selecciona un archivo":"Debes completar tu perfil primero",variant:"destructive"});y(!0);try{let t=f.name.split(".").pop(),a=`${e}/${d}_${Date.now()}.${t}`,{data:s,error:i}=await h.storage.from("distributor-documents").upload(a,f,{cacheControl:"3600",upsert:!1});i&&console.error("Storage error:",i);let r=null;if(s){let{data:e}=h.storage.from("distributor-documents").getPublicUrl(a);r=e.publicUrl}let o=null,n=null;if("estados_financieros"===d){let e=new Date;n=e.getFullYear(),o=new Date(e.getFullYear()+1,3,30).toISOString()}let{error:c}=await h.from("distributor_documents").upsert({distributor_id:e,document_type:d,file_name:f.name,file_url:r,file_size:f.size,mime_type:f.type,fiscal_year:n,expires_at:o,status:"pending"},{onConflict:"distributor_id,document_type,fiscal_year"});if(c){if(console.error("DB error:",c),"42P01"===c.code)return void m({title:"Configuración pendiente",description:"El sistema de documentos está siendo configurado. Intenta más tarde.",variant:"destructive"});throw c}m({title:"Documento subido",description:"El documento está pendiente de revisión"}),x(null),p?.(),u.refresh()}catch(e){console.error("Upload error:",e),m({title:"Error al subir",description:e.message||"No se pudo subir el documento",variant:"destructive"})}finally{y(!1)}};return e?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"file",id:`file-${d}`,className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:v,disabled:_}),(0,t.jsx)("label",{htmlFor:`file-${d}`,className:"flex-1 cursor-pointer",children:(0,t.jsx)("div",{className:"flex items-center justify-center gap-2 p-3 border-2 border-dashed rounded-lg hover:border-primary hover:bg-muted/50 transition-colors",children:f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.FileText,{className:"h-4 w-4 text-primary"}),(0,t.jsx)("span",{className:"text-sm truncate max-w-[150px]",children:f.name})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.Upload,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Seleccionar archivo"})]})})})]}),f&&(0,t.jsx)(r.Button,{onClick:g,disabled:_,size:"sm",className:"w-full",children:_?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Subiendo..."]}):"Subir documento"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"PDF, JPG o PNG. Máximo 10MB."})]}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Completa tu perfil para subir documentos"})}e.s(["DocumentUploader",()=>d])}]);